<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

<title>Sorting and Filtering Objects in DOM</title>
</head>
<body>

<div id="wrap">
    <header id="header">
        <div class="input-wrap">
            <select id="search-option">
                <option value="name">상품명</option>
                <option value="number">번호</option>
            </select>
            <input type="text" id="search" placeholder="검색">
        </div>
        <div class="sort">
            <button type="button" class="sort-btn active" data-id="data-container">날짜</button>
            <button type="button" class="sort-btn" data-id="data-container2">번호</button>
        </div>
    </header>
    <main id="main">
        <div id="data-container" class="list-wrap active"></div>
        <div id="data-container2" class="list-wrap"></div>
    </main>
</div>

<!-- 모달 이미지 -->
<div id="myModal" class="modal" onclick="hideImage()">
    <!-- <span class="close">&times;</span> -->
    <img class="modal-content" id="modalImg">
  </div>

<style>
    /* reset */
    *, *::before, *::after {box-sizing:border-box;}
    body,div,dl,dt,dd,ul,ol,li,h1,h2,h3,h4,h5,h6,pre,code,form,fieldset,legend,textarea,p,blockquote,th,td,input,select,textarea,button{margin:0;padding:0}
    fieldset,img{border:0 none}
    dl,ul,ol,menu,li {list-style:none}
    blockquote, q {quotes: none}
    blockquote:before, blockquote:after,q:before, q:after {content:'';content:none}
    input,select,textarea,button {vertical-align:middle;outline:none}
    input::-ms-clear {display:none}
    button {border:0 none;background-color:transparent;cursor:pointer}
    body,th,td,input,select,textarea,button {font-size:14px;line-height:1.5;font-family:-apple-system, BlinkMacSystemFont, Pretendard, "Segoe UI", Roboto, Oxygen-Sans, Ubuntu, Cantarell,'Noto Sans KR', 'Spoqa Han Sans', "Helvetica Neue", sans-serif;}
    a {color:#333;text-decoration:none} 
    a:active, a:hover {text-decoration:underline}
    a:active {background-color:transparent}
    address,caption,cite,code,dfn,em,var {font-style:normal;font-weight:normal}
    img {max-width:100%;height:auto;}
    
    body {-webkit-text-size-adjust:none;color:#111;}
    #header{position:relative;}
    .page-title {color:#fff;}
    .sort {display:flex;margin-top:4px;padding:0 16px;}
    .sort-btn {padding:8px; color:#666;}
    .sort-btn.active {color:#000;text-decoration:underline;}
    .sort-btn + .sort-btn {margin-left:8px;}

    .input-wrap {display:flex;background-color:#f2f2f2;border-bottom:1px solid #ddd;}
    .input-wrap select {height:44px;padding:0 8px;border:none;background-color:#f2f2f2;}
    .input-wrap input {width:100%;height:44px;padding-left:12px;margin-left:8px;font-size:16px;border:none;border-left:1px solid #ddd;border-bottom:1px solid #eee;background-color:#f2f2f2;border-radius:0;}

    .h-tit2 {position:relative; font-weight:700;font-size:16px;margin-bottom:12px;}
    .list + .h-tit2 {margin-top:24px;padding-top:36px;}
    .list + .h-tit2::before {content:'';display:block;position:absolute;top:0;left:-24px;right:-24px;height:12px;background-color:#ddd;}

    #main {padding:0 24px 40px;}
    .list-wrap {display:none;margin-top:20px;}
    .list-wrap.active {display:block;}

    .list {display:flex;align-items:center;}
    .list + .list {margin-top:36px;}
    .list-left {margin-right:auto;}
    .list-right {flex-shrink:0;margin-left:8px;text-align:right;}
    .list-img {width:48px;flex-shrink:0;margin-right:8px;}
    .list-img img {display:block;border-radius:4px;}
    .list-date,
    .list-number {font-size:12px;color:#666;}
    .list-name {font-size:16px;font-weight:600;}
    .list-weight {font-size:14px;color:#666;font-weight:400;}
    .list-by-unit {font-size:14px;color:#666;}
    .list-amount-group {font-size:12px;}
    .list-amount {color:#666;text-decoration:line-through;font-size:12px;}
    .list-price {font-weight:600;}

    .no-discount .list-amount,
    .no-discount .list-discount {display:none;}

    .no-weight .list-weight,
    .no-weight .list-by-unit {display:none;}

    .no-img .list-img {display:none;}


    #data-container .list-date {display:none;}
    #data-container2 .list-number {display:none;}

    .modal {display: none;position: fixed;z-index: 1;left: 0;top: 0;right:0;bottom:0;overflow: auto;background-color: rgba(0, 0, 0, 0.9);padding:12px;}
    .modal-content {display: block;margin: auto;}
</style>

<script>
// 객체 배열 생성
var data = [
    // ℓ ㎖ g kg 병 
    { date: "2024.02.17", number: 623559, name: "진로소주360", amount: 24190, discount: 0, weight:20, unit:'병'},
    { date: "2024.02.17", number: 643733, name: "카스473MLX24 캔", amount: 37990, discount: 0, weight:11352, unit:'㎖'},
    { date: "2024.02.17", number: 639952, name: "백진주쌀 10KG", amount: 36990, discount: 3000, weight:10, unit:'kg'},
    { date: "2024.02.17", number: 647983, name: "체리토마토 2KG", amount: 16990, discount: 0, weight:2, unit:'kg'},
    { date: "2024.02.17", number: 647019, name: "친환경양파망", amount: 14990, discount: 0, weight:4, unit:'kg', img:true},
    { date: "2024.02.17", number: 659969, name: "청경채 700G", amount: 7290, discount: 0, weight:700, unit:'g'},
    { date: "2024.02.17", number: 507154, name: "햄스빌베이컨", amount: 16890, discount: 0, weight:205, unit:'g'},
    { date: "2024.02.17", number: 612635, name: "찌개부침두부", amount: 5690, discount: 0, weight:840, unit:'g'},
    { date: "2024.02.17", number: 530318, name: "친환경양배추", amount: 5990, discount: 0, weight:4, unit:'kg', img:true},
];

// 날짜와 넘버로 그룹화하고 소팅하는 함수
function groupAndSortByDateAndNumber(data, sort) {
    var groupedData = {};
    data.forEach(function(item) {
        var key = null;
        if(sort === 'date') {
            key = item.date;
        } else if(sort === 'number') {
            key = item.number;
        }
        if (!groupedData[key]) {
            groupedData[key] = [];
        }
        groupedData[key].push(item);
    });

    // 날짜별로 객체 배열 소팅
   /*  for (var key in groupedData) {
        if (groupedData.hasOwnProperty(key)) {
            groupedData[key].sort(function(a, b) {
                return a.number - b.number;
            });
        }
    } */

    return groupedData;
}

// amount에 쉼표 추가하는 함수
/* function addCommasToAmount(amount) {
    return amount.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
} */

// amount에 쉼표 추가하는 함수
function addCommasToAmount(amount) {
    // 입력된 값이 문자열인지 확인합니다.
    if (typeof amount !== 'string') {
        amount = amount.toString();
    }
    
    // 소수점을 찾습니다.
    const decimalIndex = amount.indexOf(".");
    if (decimalIndex !== -1) {
        // 소수점 이하 3자리까지만 유지합니다.
        amount = parseFloat(amount).toFixed(1);
        // 소수점 이하의 0을 모두 제거합니다.
        amount = amount.replace(/\.?0*$/, "");
    }
    // 쉼표 추가
    return amount.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
}


// 데이터를 DOM에 표시하는 함수
function renderData(data, container, sort) {
    // 기존 내용 비우기
    container.innerHTML = "";

    // 날짜별로 그룹화하고 넘버별로 소팅
    var groupedData = groupAndSortByDateAndNumber(data, sort);

    // 날짜순으로 소팅
    var dates = Object.keys(groupedData).sort();

    // 날짜별로 데이터 표시
    dates.forEach(function(date) {
        var dateDiv = document.createElement("div");
        dateDiv.classList.add('h-tit2')
        dateDiv.textContent = `${date}`;
        container.appendChild(dateDiv);

        groupedData[date].forEach(function(item) {
            var div = document.createElement("div");
            div.classList.add('list');
            var price = item.amount - item.discount;
            var formattedPrice = addCommasToAmount(price);
            var formattedAmount = addCommasToAmount(item.amount);
            var formattedDiscount = addCommasToAmount(item.discount);
            // 할인이 없는 경우 금액만 노출
            if(item.discount === 0) {
                div.classList.add('no-discount')
            }
            // 무게가 없는 경우 노출 제외
            if(item.weight === 0) {
                div.classList.add('no-weight')
            }
             // 이미지가 없는 경우 노출 제외
             if(item.img !== true) {
                div.classList.add('no-img')
            }
            // 단위 당 금액
            var listByUnit = null;
            switch(item.unit) {
                case 'g' :
                    listByUnit = '100g 당 ' + addCommasToAmount(price / item.weight * 100) + '원';
                    break;
                case 'kg' :
                    listByUnit = '100g 당 ' + addCommasToAmount(price / item.weight / 10) + '원';
                    break;
                case '㎖' :
                    listByUnit = '100㎖ 당 ' + addCommasToAmount(price / item.weight * 100) + '원';
                    break;
                case 'ℓ' :
                    listByUnit = '100㎖ 당 ' + addCommasToAmount(price / item.weight / 10) + '원';
                    break;
                case '병' :
                    listByUnit = '1병 당 ' + addCommasToAmount(price / item.weight) + '원';
                    break;
            }
            div.innerHTML = `
                <div class="list-img"><img src="./img/${item.number}.jpg" alt="" onclick="showImage('./img/${item.number}.jpg')"></div>
                <div class="list-left">
                    <div class="list-date">${item.date}</div>
                    <div class="list-number">${item.number}</div>
                    <div class="list-name">
                        ${item.name}
                        <span class="list-weight">${addCommasToAmount(item.weight)}${item.unit}</span>
                    </div>
                </div>
                <div class="list-right">
                    <div class="list-amount-group">
                        <span class="list-amount">${formattedAmount}</span>
                        <span class="list-discount">(${formattedDiscount}원 할인)</span>
                    </div>
                    <div class="list-price">${formattedPrice}원</div>
                    <div class="list-by-unit">${listByUnit}</div>
                </div>
            `;
            container.appendChild(div);
        });
    });
}

// 이미지 확대하기
function showImage(imageSrc) {
    var modal = document.getElementById('myModal');
    var modalImg = document.getElementById("modalImg");
    
    modal.style.display = "flex";
    modalImg.src = imageSrc;
  }

  // 이미지 닫기
  function hideImage() {
    var modal = document.getElementById('myModal');
    modal.style.display = "none";
  }

// 검색 기능 구현
document.getElementById("search").addEventListener("input", function() {
    var searchTerm = this.value.trim().toLowerCase();
    var searchOption = document.getElementById("search-option").value;
    var filteredData = data.filter(function(item) {
        return item[searchOption].toString().includes(searchTerm);
    });
    renderData(filteredData, document.getElementById('data-container'), 'date');
    renderData(filteredData, document.getElementById('data-container2'), 'number');
});

/* document.getElementById("search").addEventListener("input", function() {
    var searchTerm = this.value.trim().toLowerCase();
    var filteredData = data.filter(function(item) {
        return item.name.toString().includes(searchTerm);
    });
    var filteredData2 = data.filter(function(item) {
        return item.number.toString().includes(searchTerm);
    });
    renderData(filteredData, document.getElementById('data-container'), 'date');
    renderData(filteredData2, document.getElementById('data-container2'), 'number');
}); */

function siblings(ele) {
    if(typeof(ele) === 'string') {
        ele = document.querySelector(ele)
    }
    var siblings = [...ele.parentNode.children].filter((child) =>
        child !== ele
    )
    return siblings
}


// 탭
var sort = document.querySelectorAll('.sort-btn');
var listWrap = document.querySelectorAll('.list-wrap');

sort.forEach(function(item) {
    item.addEventListener('click', function() {
        var si = siblings(item)
        si.forEach(function(item) {
            item.classList.remove('active');
        });
        item.classList.add('active');

        listWrap.forEach(function(item) {
            item.classList.remove('active')
        });
        var tarId = document.getElementById(item.dataset.id);
        tarId.classList.add('active')
    })
})

// 초기 데이터를 DOM에 렌더링
renderData(data, document.getElementById('data-container'), 'date');
renderData(data, document.getElementById('data-container2'), 'number');
</script>

</body>
</html>
