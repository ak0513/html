<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>운동 기록</title>
    <link rel="stylesheet" href="./css/style.css">
</head>
<body>
    <div id="wrap">
        <div id="searchBar">
            <input type="text" id="searchInput" placeholder="검색어 입력" oninput="searchData()">
        </div>
        <div id="btnTop">
            <div class="btnTop-inner">
                <button type="button" onclick="sortData('date')" class="btn-date">날짜</button>
                <div id="btnPart"></div>
            </div>
        </div>
        <div id="btnKindWrap">
            <div id="btnKind"></div>
        </div>
        <div id="container"></div>
        <!-- https://myhappybody.net/tests/1rm -->
    </div>
    <script>
        var data = [
            {date: "2024.07.08", part: "하체", kind: "데드 리프트", set: [{weight: "0", number: "20"}, {weight: "10", number: "20"}, {weight: "20", number: "20"},{weight: "30", number: "20"}]},
            {date: "2024.07.08", part: "등", kind: "암 풀 다운", set: [{weight: "5", number: "20"}, {weight: "10", number: "20"}, {weight: "10", number: "20"}], desc:"케이블 암 풀 다운"},
            {date: "2024.07.08", part: "등", kind: "랫 풀 다운", set: [{weight: "20", number: "20"}, {weight: "25", number: "20"}, {weight: "30", number: "20"}], desc:"언더 그립, 언더 그립이 무게를 더 친다."},
            {date: "2024.07.08", part: "등", kind: "티 바 로우", set: [{weight: "0", number: "20"}, {weight: "5", number: "20"}, {weight: "5", number: "20"}], desc:"머신 말고 바로 진행"},
            {date: "2024.07.08", part: "가슴", kind: "딥스", set: [{weight: "0", number: "20"}, {weight: "0", number: "20"}, {weight: "0", number: "20"}], desc:"점프해서 버티고 내려오기"},

            {date: "2024.07.05", part: "하체", kind: "레그 컬", set: [{weight: "12", number: "20"}, {weight: "16", number: "20"}, {weight: "20", number: "20"},{weight: "24", number: "20"}]},
            {date: "2024.07.05", part: "하체", kind: "스쿼트", set: [{weight: "15", number: "20"}, {weight: "15", number: "20"}, {weight: "15", number: "20"}], desc: "와이드 스쿼트"},
            {date: "2024.07.05", part: "하체", kind: "스쿼트", set: [{weight: "0", number: "20"}, {weight: "0", number: "15"}, {weight: "0", number: "12"}], desc: "불가리안 스플릿 스쿼트/5초 버티기"},
            {date: "2024.07.05", part: "어깨", kind: "밀리터리 프레스", set: [{weight:"9.5", number:"20"},{weight:"11.5", number:"20"},{weight:"11.5", number:"5"},], desc:'마지막 세트 도움받아 15개'},
            {date: "2024.07.05", part: "어깨", kind: "프론트 레이즈", set: [{weight:"5", number:"20"},{weight:"5", number:"20"},{weight:"5", number:"20"},], desc:'원판 들고'},
            {date: "2024.07.05", part: "어깨", kind: "암 풀 다운", set: [{weight:"0", number:"20"},{weight:"0", number:"20"},{weight:"0", number:"20"},], desc:'파란색 밴드'},


            {date: "2024.07.02", part: "등", kind: "랫 풀 다운", set: [{weight: "20", number: "20"}, {weight: "25", number: "20"}, {weight: "30", number: "20"}]},
            {date: "2024.07.02", part: "등", kind: "티 바 로우", set: [{weight:"0", number:"20"},{weight:"10", number:"20"},{weight:"10", number:"20"}]},
            {date: "2024.07.02", part: "가슴", kind: "인클라인 푸시업", set: [{weight:"0", number:"20"},{weight:"0", number:"20"},{weight:"0", number:"20"}]},
            {date: "2024.07.02", part: "등", kind: "백 익스텐션", set: [{weight: "0", number: "15"}, {weight: "0", number: "15"}, {weight: "0", number: "15"}]},
            {date: "2024.07.02", part: "가슴", kind: "딥스", set: [{weight: "0", number: "15"}, {weight: "0", number: "15"}, {weight: "0", number: "20"}]},

            {date: "2024.06.27", part: "하체", kind: "데드 리프트", set: [{weight: "20", number: "20"}, {weight: "25", number: "20"}, {weight: "30", number: "20"}], desc: "루마니안 데드 리프트"},
            {date: "2024.06.27", part: "가슴", kind: "인클라인 덤벨 체스트 프레스", set: [{weight: "5", number: "20"}, {weight: "6", number: "20"}]},
            {date: "2024.06.27", part: "등", kind: "티 바 로우", set: [{weight: "0", number: "20"}, {weight: "5", number: "20"}, {weight: "10", number: "20"}]},
            {date: "2024.06.27", part: "하체", kind: "사이드 스텝", set: [{weight: "0", number: "20"}, {weight: "0", number: "20"}, {weight: "0", number: "30"}, {weight: "0", number: "25"}]},
            {date: "2024.06.27", part: "코어", kind: "크런치", set: [{weight: "0", number: "20"}, {weight: "0", number: "20"}, {weight: "0", number: "20"}]},

            {date: "2024.06.24", part: "어깨", kind: "밀리터리 프레스", set: [{weight:"9.5", number:"20"},{weight:"9.5", number:"20"},{weight:"9.5", number:"20"},]},
            {date: "2024.06.24", part: "어깨", kind: "인클라인 덤벨 숄더 프레스", set: [{weight:"3", number:"20"},{weight:"1.5", number:"20"},{weight:"1.5", number:"20"},]},
            {date: "2024.06.24", part: "어깨", kind: "사이드 레터럴 레이즈", set: [{weight:"3", number:"20"},{weight:"3", number:"20"},{weight:"3", number:"20"},]},
            {date: "2024.06.24", part: "등", kind: "벤트 오버 레터럴 레이즈", set: [{weight:"3", number:"20"},{weight:"3", number:"20"},{weight:"3", number:"20"},]},
            {date: "2024.06.24", part: "하체", kind: "레그 프레스", set: [{weight:"0", number:"20"},{weight:"20", number:"20"},{weight:"20", number:"20"},{weight:"20", number:"20"},]},
            {date: "2024.06.24", part: "코어", kind: "버피", set: [{weight:"0", number:"20"},{weight:"0", number:"20"},{weight:"0", number:"20"},{weight:"0", number:"20"},]},

            {date: "2024.06.20", part: "가슴", kind: "벤치 프레스", set: [{weight:"15", number:"20"},{weight:"15", number:"20"},{weight:"20", number:"15"},{weight:"20", number:"15"},]},
            {date: "2024.06.20", part: "가슴", kind: "인클라인 덤벨 체스트 프레스", set: [{weight:"4", number:"20"},{weight:"5", number:"20"},{weight:"6", number:"20"},]},
            {date: "2024.06.20", part: "가슴", kind: "딥스", set: [{weight:"0", number:"20"},{weight:"0", number:"20"},{weight:"0", number:"20"},]},
            {date: "2024.06.20", part: "등", kind: "랫 풀 다운", set: [{weight:"20", number:"20"},{weight:"25", number:"20"},{weight:"30", number:"15"},]},
            {date: "2024.06.20", part: "등", kind: "바벨 벤트 오버 로우", set: [{weight:"15", number:"20"},{weight:"15", number:"20"},{weight:"9.5", number:"20"},]},
            {date: "2024.06.20", part: "코어", kind: "마운틴 클라이머", set: [{weight:"0", number:"20"}],desc: "30초씩 3세트 추가"},

            {date: "2024.06.17", part: "하체", kind: "스쿼트", set: [{weight:"20", number:"20"},{weight:"25", number:"15"},{weight:"30", number:"12"},{weight:"35", number:"10"},]},
            {date: "2024.06.17", part: "하체", kind: "런지", set: [{weight:"0", number:"20"},{weight:"0", number:"20"},{weight:"0", number:"20"}],desc: "5초 버티기"},
            {date: "2024.06.17", part: "하체", kind: "힙 스터스트", set: [{weight:"0", number:"20"},{weight:"0", number:"20"},{weight:"0", number:"20"},],desc: "밴드 끼고"},
            {date: "2024.06.17", part: "어깨", kind: "사이드 레터럴 레이즈", set: [{weight:"1.5", number:"20"},{weight:"3", number:"20"}]},
            {date: "2024.06.17", part: "어깨", kind: "써클 레이즈", set: [{weight:"1", number:"20"},{weight:"1", number:"20"}]},

            {date: "2024.06.13", part: "등", kind: "데드 리프트", set: [{weight:"20", number:"20"},{weight:"20", number:"20"},{weight:"20", number:"20"},], desc: "루마니안 데드 리프트"},
            {date: "2024.06.13", part: "등", kind: "랫 풀 다운", set: [{weight:"20", number:"20"},{weight:"30", number:"20"},{weight:"35", number:"15"},]},
            {date: "2024.06.13", part: "등", kind: "케이블 로우", set: [{weight:"20", number:"20"},{weight:"25", number:"20"},{weight:"30", number:"20"},]},
            {date: "2024.06.13", part: "가슴", kind: "벤치 프레스", set: [{weight:"20", number:"20"},{weight:"20", number:"20"},{weight:"20", number:"20"},]},
            {date: "2024.06.13", part: "가슴", kind: "딥스", set: [{weight:"0", number:"20"},{weight:"0", number:"15"}]},

            {date: "2024.06.10", part: "코어", kind: "힙 브릿지", set: [{weight:"0", number:"20"},{weight:"0", number:"20"},{weight:"0", number:"20"},], desc: "10초 버티기"},
            {date: "2024.06.10", part: "하체", kind: "스쿼트", set: [{weight:"20", number:"20"},{weight:"25", number:"20"},{weight:"30", number:"20"},{weight:"0", number:"20"},]},
            {date: "2024.06.10", part: "하체", kind: "레그 컬", set: [{weight:"8", number:"20"},{weight:"12", number:"20"},{weight:"16", number:"20"},]},
            {date: "2024.06.10", part: "어깨", kind: "밀리터리 프레스", set: [{weight:"9.5", number:"20"},{weight:"9.5", number:"20"},{weight:"9.5", number:"20"},]},
            {date: "2024.06.10", part: "어깨", kind: "인클라인 덤벨 숄더 프레스", set: [{weight:"3", number:"12"},{weight:"3", number:"12"}]},
            {date: "2024.06.10", part: "어깨", kind: "사이드 레터럴 레이즈", set: [{weight:"1.5", number:"20"},{weight:"1.5", number:"20"},{weight:"1.5", number:"20"},]},

            {date: "2024.06.07", part: "등", kind: "랫 풀 다운", set: [{ weight:"20", number:"20"},{weight:"25", number:"20"},{weight:"30", number:"20"},]},
            {date: "2024.06.07", part: "가슴", kind: "벤치 프레스", set: [{weight:"15", number:"20"},{weight:"20", number:"20"},{weight:"20", number:"20"},]},
            {date: "2024.06.07", part: "등", kind: "티 바 로우", set: [{weight:"0", number:"20"},{weight:"5", number:"20"},{weight:"5", number:"20"},{weight:"5", number:"20"},]},
            {date: "2024.06.07", part: "가슴", kind: "인클라인 덤벨 체스트 프레스", set: [{weight:"5", number:"20"},{ weight:"5", number:"20",},{ weight:"5", number:"20",},]},
            {date: "2024.06.07", part: "등", kind: "백 익스텐션", set: [{weight:"0", number:"15"},{weight:"0", number:"15"},{weight:"0", number:"15"},],desc: "5초 버티기"},
            
            {date: "2024.06.04", part: "하체", kind: "스쿼트", set: [{number:"20", weight:"15"},{number:"20", weight:"20"},]},
            {date: "2024.06.04", part: "하체", kind: "레그 프레스", set: [{weight:"0", number:"20"},{weight:"0", number:"20"},{ weight:"0", number:"20",},],desc: "5초 버티기"},
            {date: "2024.06.04", part: "어깨", kind: "밀리터리 프레스", set: [{weight:"9", number:"20"},{weight:"9", number:"20"},{weight:"9", number:"20"},]},
            {date: "2024.06.04", part: "어깨", kind: "사이드 레터럴 레이즈", set: [{weight:"1", number:"20"},{weight:"1.5", number:"20"},]},
        ]

        var buttonPartContainer = document.getElementById('btnPart');
        var buttonKindContainer = document.getElementById('btnKind');
        var container = document.getElementById('container');

        // 데이터를 정렬하고 DOM에 추가하는 함수
        function sortData(criterion) {
            var groupedData = data.reduce((acc, item) => {
                var key = item[criterion];
                if (!acc[key]) {
                    acc[key] = [];
                }
                acc[key].push(item);
                return acc;
            }, {});

            container.innerHTML = '';

            var sortedKeys = Object.keys(groupedData).sort((a, b) => {
                if (criterion === 'date') {
                    return new Date(b) - new Date(a); // 날짜별 내림차순 정렬
                } else {
                    return a.localeCompare(b);
                }
            });

            // 정렬된 키를 순회하며 데이터를 DOM에 추가
            sortedKeys.forEach(key => {
                setTitle(key);
                groupedData[key].forEach(item => {
                    setKind(item, criterion);
                });
            });

            // 추가: part 버튼 설정
            var partCounts = data.reduce((acc, item) => {
                acc[item.part] = (acc[item.part] || 0) + 1;
                return acc;
            }, {});

            var parts = Object.keys(partCounts).sort((a, b) => partCounts[b] - partCounts[a]);

            buttonPartContainer.innerHTML = '';
            parts.forEach(part => {
                var button = document.createElement('button');
                button.setAttribute('type', 'button');
                button.textContent = `${part}(${partCounts[part]})`;
                button.onclick = function() { 
                    showPart(part);
                    // 버튼 클릭 시 active 클래스 관리
                    var activeButton = buttonPartContainer.querySelector('button.active');
                    if (activeButton) {
                        activeButton.classList.remove('active');
                    }
                    button.classList.add('active');
                };
                buttonPartContainer.appendChild(button);
            });
        }

        // 모든 part의 데이터를 표시하는 함수
        function showAllParts() {
            container.innerHTML = '';
            var groupedData = data.reduce((acc, item) => {
                var key = item.part;
                if (!acc[key]) {
                    acc[key] = [];
                }
                acc[key].push(item);
                return acc;
            }, {});

            Object.keys(groupedData).forEach(part => {
                setTitle(part, part);

                groupedData[part].forEach(item => {
                    setKind(item);
                });
            });
        }

        // 특정 part의 데이터를 표시하고 kind 버튼을 모두 노출하는 함수
        function showPart(part) {
            var partData = data.filter(item => item.part === part);
            var kindCounts = partData.reduce((acc, item) => {
                acc[item.kind] = (acc[item.kind] || 0) + 1;
                return acc;
            }, {});

            var kinds = Object.keys(kindCounts).sort((a, b) => kindCounts[b] - kindCounts[a]);

            buttonKindContainer.innerHTML = '';
            kinds.forEach(kind => {
                var button = document.createElement('button');
                button.setAttribute('type', 'button');
                button.textContent = `${kind}(${kindCounts[kind]})`;
                button.onclick = function() { 
                    showKind(kind);
                    // 버튼 클릭 시 active 클래스 관리
                    var activeButton = buttonKindContainer.querySelector('button.active');
                    if (activeButton) {
                        activeButton.classList.remove('active');
                    }
                    button.classList.add('active');
                };
                buttonKindContainer.appendChild(button);
            });

            // part 데이터를 모두 보여줌
            container.innerHTML = '';
            setTitle(part, part);

            partData.forEach(item => {
                setKind(item, 'kind');
            });
        }

        // 특정 kind의 데이터를 표시하는 함수
        function showKind(kind) {
            var kindData = data.filter(item => item.kind === kind);
            container.innerHTML = '';
            setTitle(kind, kindData[0].part);

            kindData.forEach(item => {
                setKind(item, 'kindDate');
            });
        }

        // 검색 기능 추가
        function searchData() {
            var searchInput = document.getElementById('searchInput').value.trim();
            if (searchInput === '') {
                // 검색어가 없으면 전체 데이터 초기화 (원하는 경우)
                buttonKindContainer.innerHTML = '';
                container.innerHTML = '';
                setTitle('검색 결과 없음');
                return;
            }

            var searchResults = data.filter(item => item.kind.includes(searchInput));
            buttonKindContainer.innerHTML = '';
            container.innerHTML = '';

            if (searchResults.length === 0) {
                setTitle('검색 결과 없음');
                return;
            }

            var kindCounts = searchResults.reduce((acc, item) => {
                acc[item.kind] = (acc[item.kind] || 0) + 1;
                return acc;
            }, {});

            var kinds = Object.keys(kindCounts).sort((a, b) => kindCounts[b] - kindCounts[a]);

            kinds.forEach(kind => {
                var button = document.createElement('button');
                button.setAttribute('type', 'button');
                button.textContent = `${kind}(${kindCounts[kind]})`;
                button.onclick = function() { 
                    showKind(kind);
                    // 버튼 클릭 시 active 클래스 관리
                    var activeButton = buttonKindContainer.querySelector('button.active');
                    if (activeButton) {
                        activeButton.classList.remove('active');
                    }
                    button.classList.add('active');
                };
                buttonKindContainer.appendChild(button);
            });

            setTitle('검색 결과');
            searchResults.forEach(item => {
                setKind(item, 'kind');
            });
        }


        // 타이틀 세팅
        function setTitle(text, part) {
            var title = document.createElement('h2');
            title.classList.add(`${part}`);
            if (part === undefined) { part = ''; }
            title.innerHTML = `${text}${part.length > 0 && part !== text ? `<span>[${part}]</span>` : ``}`;
            container.appendChild(title);
        }

        // 종류별 세팅
        function setKind(item, criterion) {
            var itemDiv = document.createElement('div');
            itemDiv.classList.add('item');
            itemDiv.classList.add(item.part);
            itemDiv.innerHTML = `${criterion === 'kindDate' ? `<h3>${item.date}</h3>` : `<h3>${item.kind}<span>[${item.part}]</span></h3>`} ${item.desc === undefined || item.desc === "" ? `` : `<div class="desc">${item.desc}</div>`}`;
            var setList = document.createElement('ul');
            setList.classList.add('set');
            item.set.forEach(function(setItem, index) {
                var listItem = document.createElement('li');
                listItem.innerHTML = `<ul class="set-item"><li>${index + 1}세트</li>${setItem.weight > 0 ? `<li>${setItem.weight}<small>kg</small></li>` : ''}<li>${setItem.number}<small>회</small></li>`;
                setList.appendChild(listItem);
            });

            itemDiv.appendChild(setList);
            container.appendChild(itemDiv);

            // h3 태그에 클릭 이벤트 추가
            if (criterion === 'date') {
                var h3Tag = itemDiv.querySelector('h3');
                h3Tag.addEventListener('click', function() {
                    setTimeout(function() {
                        var kindButton = Array.from(buttonKindContainer.children).find(button => button.textContent.includes(item.kind));
                        if (kindButton) {
                            kindButton.click();
                        }
                    }, 0); // 비동기적으로 처리하여 클릭 이벤트 처리
                });
            }
        }

        // 페이지 로드 시 날짜 정렬 디폴트
        sortData('date');
    </script>
</body>
</html>
