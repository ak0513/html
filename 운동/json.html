<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Input to JSON</title>
    <!-- jQuery와 jQuery UI CSS 포함 -->
    <link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
    <link rel="stylesheet" href="../basic/css/style.css">
</head>
<body>
    <style>
        input,select,button {display:flex;align-items:center;width:100%;height:40px;margin-top:4px; font-size:16px;padding:0 8px;;border:1px solid #ddd;border-radius:4px;color:#333;box-sizing:border-box;}
        pre {white-space: inherit;}
    </style>
    <form id="userForm">
        <input type="text" id="date" name="date" autocomplete="off" placeholder="날짜">

        <select id="part" name="part">
            <option value="">운동 부위</option>
            <option value="가슴(대흉근 안쪽)">가슴(대흉근 안쪽)</option>
            <option value="등(광배근)">등(광배근)</option>
            <option value="어깨(삼각근)">어깨(삼각근)</option>
            <option value="팔(이두근)">팔(이두근)</option>
            <option value="하체(대퇴근)">하체(대퇴근)</option>
        </select>


        <select id="kind" name="kind">
            <option value="">운동종류</option>
            <option value=""></option>
            <option value="">### 가슴 ###</option>
            <option value="시티드 체스트 프레스">시티드 체스트 프레스</option>
            <option value="인클라인 덤벨 체스트 프레스">인클라인 덤벨 체스트 프레스</option>
            <option value="펙 덱 플라이">펙 덱 플라이</option>
            <option value="딥스">딥스</option>
            <option value=""></option>

            <option value="">### 등 ###</option>
            <option value="케이블 암 풀 다운">케이블 암 풀 다운</option>
            <option value="랫 풀 다운">랫 풀 다운</option>
            <option value="시티드 로우">시티드 로우</option>
            <option value=""></option>

            <option value="">### 어깨 ###</option>
            <option value="사이드 레터럴 레이즈">사이드 레터럴 레이즈</option>
            <option value="인클라인 숄더 프레스">인클라인 숄더 프레스</option>
            <option value="시티드 숄더 프레스">시티드 숄더 프레스</option>
            <option value="리버스 펙 덱 플라이">리버스 펙 덱 플라이</option>
            <option value=""></option>

            <option value="">### 하체 ###</option>
            <option value="레그 익스텐션">레그 익스텐션</option>
            <option value="레그 컬">레그 컬</option>
            <option value="레그 프레스">레그 프레스</option>
            <option value="스쿼트">스쿼트</option>
            <option value=""></option>

            <option value="">### 팔 ###</option>
            <option value="바벨 컬">바벨 컬</option>
        </select>

        <input type="tel" id="number" name="number" autocomplete="off" placeholder="횟수">

        <input type="tel" id="weight" name="weight" autocomplete="off" placeholder="무게">

        <button type="button" onclick="convertToJSON()">Submit</button>
    </form>

    <pre id="result"></pre>
    <button id="downloadButton" style="display:none;" onclick="downloadJSON()">Download JSON</button>

    <script>
        $(function() {
            // jQuery UI 달력 위젯 적용
            $("#date").datepicker({
                dateFormat: 'yy.mm.dd' // 날짜 형식 설정
            });
        });

        // 기존 데이터를 저장할 변수
        let accumulatedData = [];

        function convertToJSON() {
            // 폼 요소 가져오기
            const form = document.getElementById('userForm');

            // 폼 데이터를 JSON 형식으로 변환
            const formData = new FormData(form);
            const date = formData.get('date');
            const part = formData.get('part');
            const kind = formData.get('kind');
            const number = formData.get('number');
            const weight = formData.get('weight');

            // 새로운 세트 객체 생성
            const newSet = { number: number, weight: weight };

            // 기존 데이터에서 날짜와 운동 종류가 같은 항목 찾기
            let existingEntry = accumulatedData.find(entry => entry.date === date && entry.kind === kind);

            if (existingEntry) {
                // 기존 항목에 세트 추가
                existingEntry.set.push(newSet);
            } else {
                // 새로운 항목 생성
                const newEntry = {
                    date: date,
                    part: part,
                    kind: kind,
                    set: [newSet]
                };
                accumulatedData.push(newEntry);
            }

            // 결과를 JSON 유사 문자열로 변환
            const jsonString = toCustomJSONString(accumulatedData);

            // 결과를 화면에 표시
            document.getElementById('result').textContent = jsonString;

            // 다운로드 버튼 표시
            document.getElementById('downloadButton').style.display = 'block';
        }

        function toCustomJSONString(obj) {
            if (Array.isArray(obj)) {
                return '[' + obj.map(toCustomJSONString).join(', ') + ']';
            } else if (typeof obj === 'object' && obj !== null) {
                return '{' + Object.keys(obj).map(key => `${key}: ${toCustomJSONString(obj[key])}`).join(', ') + '}';
            } else {
                return JSON.stringify(obj);
            }
        }

        function downloadJSON() {
            // 누적된 데이터를 JSON 유사 문자열로 변환
            const jsonString = toCustomJSONString(accumulatedData);

            // JSON 문자열을 Blob으로 변환
            const blob = new Blob([jsonString], { type: 'application/json' });
            const url = URL.createObjectURL(blob);

            // 다운로드 링크 생성 및 클릭
            const downloadLink = document.createElement('a');
            downloadLink.href = url;
            downloadLink.download = 'data.json';
            downloadLink.click();

            // URL 객체 해제
            URL.revokeObjectURL(url);
        }
    </script>
</body>
</html>
