<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
    <style>
        #aa {background-color: antiquewhite;padding:8px;border-radius:16px;}
        #aa div {padding:20px 4px;margin-top:4px;border-top:1px solid #ddd;display:flex;}
        /* #aa [data-bx-hidden='true'] {display:none;} */
    </style>
    <div id="aa">
        <div data-bx-hidden="true" style="display:none;">111</div>
        <div>222</div>
        <div>222</div>
        <div data-bx-hidden="true" style="display:none;">111</div>
        <div>222</div>
        <div data-bx-hidden="true" style="display:none;">111</div>
    </div>
    <button type="button" class="toggleButton" aria-expanded="false" onclick="toggle('#aa')">btn</button>

    <script>
window.addEventListener('load', function() {
  document.querySelectorAll('[data-bx-hidden="true"]').forEach(function(element) {
    element.style.display = 'none';
  });
});
        function toggle(selector) {
            const container = $(selector);
            let slideAnimationCount = 0;

            // data-bx-hidden 속성을 가진 요소에 대해서만 슬라이드 효과 적용
            container.children('[data-bx-hidden]').each(function() {
                const element = $(this);
                const currentValue = element.attr('data-bx-hidden');
                slideAnimationCount++;

                // 슬라이드 효과와 data-bx-hidden 값을 toggle
                element.stop(true, true).slideToggle(function() {
                    slideAnimationCount--;
                    // data-bx-hidden 값을 변경
                    element.attr('data-bx-hidden', currentValue === 'true' ? 'false' : 'true');
                    // aria-expanded 값 갱신
                    if (slideAnimationCount === 0) {
                        const button = $('button.toggleButton');
                        button.attr('aria-expanded', element.attr('data-bx-hidden') === 'true' ? 'false' : 'true');
                    }
                });
            });
        }
    </script>
</body>
</html>
