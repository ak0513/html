<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>Chips Wrap Example</title>
<style>
.chips-container {
    display: flex;
    overflow-x: auto;
    gap: 8px;
    scroll-behavior: smooth;
}
.chip {
    flex: 0 0 auto;
    padding: 8px 12px;
    background: #ddd;
    border-radius: 20px;
}
.chips-wrap.vertical .chips-container {
    flex-wrap: wrap;
    overflow-x: hidden;
}
.chips-wrap.scroll-end {
    background-color: #f5f5f5; /* 스크롤 끝일 때 예시 */
}
.toggle-btn {
    margin-top: 5px;
}
.toggle-btn.hidden {
    display: none;
}
</style>
</head>
<body>

<div class="chips-wrap">
    <div class="chips-container">
        <div class="chip">칩1</div>
        <div class="chip">칩2</div>
        <div class="chip">칩3</div>
        <div class="chip">칩4</div>
        <div class="chip">칩5</div>
    </div>
    <button class="toggle-btn">토글</button>
</div>

<div class="chips-wrap">
    <div class="chips-container">
        <div class="chip">A</div>
        <div class="chip">B</div>
    </div>
    <button class="toggle-btn">토글</button>
</div>

<script>
function initChipsWrap(wrap) {
    const container = wrap.querySelector('.chips-container');
    const toggleBtn = wrap.querySelector('.toggle-btn');

    // 토글 버튼 클릭 → vertical 클래스 토글
    toggleBtn.addEventListener('click', () => {
        wrap.classList.toggle('vertical');
    });

    // 스크롤 끝 감지
    const checkScrollEnd = () => {
        const isEnd = Math.ceil(container.scrollLeft + container.clientWidth) >= container.scrollWidth;
        wrap.classList.toggle('scroll-end', isEnd);
    };

    // 토글 버튼 노출 여부 체크
    const checkToggleVisibility = () => {
        const hasScroll = container.scrollWidth > container.clientWidth;
        toggleBtn.classList.toggle('hidden', !hasScroll);
    };

    const updateState = () => {
        checkScrollEnd();
        checkToggleVisibility();
    };

    container.addEventListener('scroll', checkScrollEnd);
    window.addEventListener('resize', updateState);

    // 칩스 동적 추가/제거 감지
    const observer = new MutationObserver(updateState);
    observer.observe(container, { childList: true, subtree: true });

    updateState();
}

// 초기 로드 시 모든 랩 초기화
document.querySelectorAll('.chips-wrap').forEach(initChipsWrap);

// chips-wrap 자체 동적 생성 감지
const wrapObserver = new MutationObserver((mutations) => {
    mutations.forEach((mutation) => {
        mutation.addedNodes.forEach((node) => {
            if (node.classList && node.classList.contains('chips-wrap')) {
                initChipsWrap(node);
            }
        });
    });
});
wrapObserver.observe(document.body, { childList: true, subtree: true });
</script>

</body>
</html>