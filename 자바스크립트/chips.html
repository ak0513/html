<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Chips Wrap ìƒ˜í”Œ</title>
<style>
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif; padding: 16px; }
    .chips-wrap { margin: 16px 0; }

    /* ì¹©ìŠ¤ ì»¨í…Œì´ë„ˆ: ê°€ë¡œ ìŠ¤í¬ë¡¤ ê°€ëŠ¥ */
    .chips-container {
        display: flex;                  /* ì¹©ë“¤ì„ ê°€ë¡œ ë‚˜ì—´ */
        gap: 8px;                       /* ì¹© ê°„ê²© */
        overflow-x: auto;               /* ê°€ë¡œ ìŠ¤í¬ë¡¤ ê°€ëŠ¥ */
        padding-bottom: 6px;            /* ëª¨ë°”ì¼ ì†ê°€ë½ ìŠ¤í¬ë¡¤ í¸ì˜ */
        scroll-behavior: smooth;        /* ìŠ¤í¬ë¡¤ ë¶€ë“œëŸ½ê²Œ */
        -webkit-overflow-scrolling: touch; /* iOS ìŠ¤í¬ë¡¤ ìµœì í™” */
    }

    /* ì¹© ìŠ¤íƒ€ì¼ */
    .chip {
        flex: 0 0 auto;                 /* í¬ê¸° ê³ ì •, ì¶•ì†Œ ê¸ˆì§€ */
        padding: 8px 12px;
        background: #e9e9ee;
        border-radius: 20px;
        white-space: nowrap;            /* ì¤„ë°”ê¿ˆ ì—†ì´ í‘œì‹œ */
        font-size: 14px;
    }

    /* ë²„í‹°ì»¬ ëª¨ë“œ: ì„¸ë¡œ ë‚˜ì—´ */
    .chips-wrap.vertical .chips-container {
        flex-wrap: wrap;                /* ì—¬ëŸ¬ ì¤„ë¡œ ë°°ì¹˜ */
        overflow-x: hidden;             /* ê°€ë¡œ ìŠ¤í¬ë¡¤ ì œê±° */
        scroll-behavior: auto;          /* ìŠ¤í¬ë¡¤ í–‰ë™ ì¦‰ì‹œ ë°˜ì˜ */
    }

    /* ìŠ¤í¬ë¡¤ ë ë„ë‹¬ ìƒíƒœ í‘œì‹œìš© (ì˜ˆì‹œ ìŠ¤íƒ€ì¼) */
    .chips-wrap.scroll-end { background: #fafafa; }

    /* í† ê¸€ ë²„íŠ¼ */
    .toggle-btn {
        margin-top: 8px;
        padding: 6px 10px;
        border-radius: 10px;
        border: 1px solid #d7d7df;
        background: #fff;
    }
    /* ìˆ¨ê¹€ ìƒíƒœ */
    .toggle-btn.hidden { display: none; }

    /* ìˆ¨ê¹€ ë¶€ëª¨ ì˜ˆì‹œ */
    .hidden-parent { display: none; padding: 10px; border: 1px dashed #ccc; margin: 20px 0; }
</style>
</head>
<body>

<h2>ğŸ“Œ ì¹©ìŠ¤ ìƒ˜í”Œ (ì´ˆê¸° ë Œë”ë§)</h2>
<div class="chips-wrap">
    <div class="chips-container">
        <div class="chip">ì¹©1</div><div class="chip">ì¹©2</div><div class="chip">ì¹©3</div>
        <div class="chip">ì¹©4</div><div class="chip">ì¹©5</div><div class="chip">ì¹©6</div>
        <div class="chip">ì¹©7</div><div class="chip">ì¹©8</div>
    </div>
    <button class="toggle-btn" type="button" aria-expanded="false">í† ê¸€</button>
</div>

<h2>ğŸ“Œ ìˆ¨ê²¨ì¡Œë‹¤ê°€ ë‚˜íƒ€ë‚˜ëŠ” ë¶€ëª¨ ì˜ˆì‹œ</h2>
<button id="show-hidden">ìˆ¨ê²¨ì§„ ë¶€ëª¨ í‘œì‹œ</button>
<div class="hidden-parent" id="hidden-parent">
    <div class="chips-wrap">
        <div class="chips-container">
            <div class="chip">ìˆ¨1</div><div class="chip">ìˆ¨2</div><div class="chip">ìˆ¨3</div>
            <div class="chip">ìˆ¨4</div><div class="chip">ìˆ¨5</div><div class="chip">ìˆ¨6</div>
        </div>
        <button class="toggle-btn" type="button" aria-expanded="false">í† ê¸€</button>
    </div>
</div>

<h2>ğŸ“Œ ë™ì  ìƒì„± ìƒ˜í”Œ</h2>
<button id="add-dynamic">ë™ì  Chips Wrap ì¶”ê°€</button>
<div id="dynamic-container"></div>

<!-- ===================== ê¸°ë³¸ Chips Wrap ìŠ¤í¬ë¦½íŠ¸ ===================== -->
<script>
/**
 * WRAP_STATE: ê° chips-wrap ìš”ì†Œì˜ ìƒíƒœë¥¼ WeakMapìœ¼ë¡œ ì €ì¥
 * vertical: í˜„ì¬ ì„¸ë¡œ ëª¨ë“œì¸ì§€ ì—¬ë¶€
 */
const WRAP_STATE = new WeakMap();

/**
 * setScrollLeftInstant
 * - ì• ë‹ˆë©”ì´ì…˜ ì—†ì´ ì¦‰ì‹œ ê°€ë¡œ ìŠ¤í¬ë¡¤ ìœ„ì¹˜ ì„¤ì •
 * - ë²„í‹°ì»¬ ì „í™˜ ì‹œ ì”ì¡´ ìŠ¤í¬ë¡¤ ì œê±°ìš©
 */
function setScrollLeftInstant(el, x) {
    const prev = el.style.scrollBehavior;
    el.style.scrollBehavior = 'auto';
    el.scrollLeft = x;
    el.style.scrollBehavior = prev || '';
}

/**
 * initChipsWrap
 * - ê°œë³„ chips-wrap ì´ˆê¸°í™”
 * - í† ê¸€, ìŠ¤í¬ë¡¤ ë ê°ì§€, í† ê¸€ ë²„íŠ¼ ìˆ¨ê¹€/í‘œì‹œ, ë™ì  ì¶”ê°€ ëŒ€ì‘
 */
function initChipsWrap(wrap) {
    const container = wrap.querySelector('.chips-container');
    const toggleBtn = wrap.querySelector('.toggle-btn');
    if (!container || !toggleBtn) return;

    // ì´ˆê¸° ìƒíƒœ ì €ì¥
    WRAP_STATE.set(wrap, { vertical: false });
    const getState = () => WRAP_STATE.get(wrap);

    // ìŠ¤í¬ë¡¤ ë ê°ì§€: ê°€ë¡œ ëª¨ë“œì—ì„œë§Œ ì˜ë¯¸
    const checkScrollEnd = () => {
        const { vertical } = getState();
        if (vertical) { wrap.classList.remove('scroll-end'); return; }
        const isEnd = Math.ceil(container.scrollLeft + container.clientWidth) >= container.scrollWidth;
        wrap.classList.toggle('scroll-end', isEnd);
    };

    // í† ê¸€ ë²„íŠ¼ ê°€ì‹œì„±: ê°€ë¡œ ëª¨ë“œì—ì„œë§Œ ìŠ¤í¬ë¡¤ ì—¬ë¶€ ì²´í¬
    const checkToggleVisibility = () => {
        const { vertical } = getState();
        const hasScroll = container.scrollWidth > container.clientWidth;
        const hide = !vertical && !hasScroll;
        toggleBtn.classList.toggle('hidden', hide);
    };

    // ìƒíƒœ ê°±ì‹  í•¨ìˆ˜
    const updateState = () => {
        checkToggleVisibility();
        checkScrollEnd();
    };

    // í† ê¸€ ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸
    toggleBtn.addEventListener('click', () => {
        const state = getState();
        const nextVertical = !state.vertical;
        state.vertical = nextVertical;
        WRAP_STATE.set(wrap, state);
        wrap.classList.toggle('vertical', nextVertical);
        toggleBtn.setAttribute('aria-expanded', String(nextVertical));

        // ë²„í‹°ì»¬ ëª¨ë“œ ì „í™˜ ì‹œ ìŠ¤í¬ë¡¤ ì´ˆê¸°í™”
        if (nextVertical) setScrollLeftInstant(container, 0);

        requestAnimationFrame(updateState); // ë‹¤ìŒ í”„ë ˆì„ì— ìƒíƒœ ê°±ì‹ 
    });

    // ì»¨í…Œì´ë„ˆ ìŠ¤í¬ë¡¤ ì´ë²¤íŠ¸
    container.addEventListener('scroll', () => {
        if (getState().vertical) { setScrollLeftInstant(container, 0); return; }
        checkScrollEnd();
    });

    // ResizeObserver: ì»¨í…Œì´ë„ˆ í¬ê¸° ë³€í™” ê°ì§€
    if ('ResizeObserver' in window) { new ResizeObserver(updateState).observe(container); } 
    else { window.addEventListener('resize', updateState); }

    // MutationObserver: ì¹©ìŠ¤ ë™ì  ì¶”ê°€/ì‚­ì œ ëŒ€ì‘
    new MutationObserver(updateState).observe(container, { childList: true, subtree: true });

    // IntersectionObserver: ë¶€ëª¨ ìˆ¨ê¹€â†’ë…¸ì¶œ ì‹œ ìƒíƒœ ê°±ì‹ 
    if ('IntersectionObserver' in window) {
        const io = new IntersectionObserver((entries) => {
            entries.forEach(entry => { if (entry.isIntersecting) updateState(); });
        }, { threshold: 0 });
        io.observe(wrap);
    }

    // ì´ˆê¸° ìƒíƒœ ì ìš©
    updateState();
}

// í˜ì´ì§€ ë¡œë“œ ì‹œ ê¸°ì¡´ chips-wrap ì´ˆê¸°í™”
document.querySelectorAll('.chips-wrap').forEach(initChipsWrap);

// body ë‚´ë¶€ ë™ì  chips-wrap ìƒì„± ê°ì§€
new MutationObserver((mutations) => {
    mutations.forEach((m) => {
        m.addedNodes.forEach((node) => {
            if (!(node instanceof HTMLElement)) return;
            if (node.classList?.contains('chips-wrap')) { initChipsWrap(node); }
            else node.querySelectorAll?.('.chips-wrap').forEach(initChipsWrap);
        });
    });
}).observe(document.body, { childList: true, subtree: true });
</script>

<!-- ===================== ìƒ˜í”Œ ë™ì‘ ìŠ¤í¬ë¦½íŠ¸ ===================== -->
<script>
/**
 * ìˆ¨ê²¨ì§„ ë¶€ëª¨ í‘œì‹œ ë²„íŠ¼
 * - ìˆ¨ê²¨ì§„ ë¶€ëª¨ë¥¼ display:blockìœ¼ë¡œ ë³€ê²½
 * - IntersectionObserverê°€ ìë™ìœ¼ë¡œ ìƒíƒœ ê°±ì‹ 
 */
document.getElementById('show-hidden').addEventListener('click', () => {
    const hidden = document.getElementById('hidden-parent');
    hidden.style.display = 'block';
});

/**
 * ë™ì  Chips Wrap ìƒì„± ë²„íŠ¼
 * - í´ë¦­ ì‹œ ìƒˆë¡œìš´ chips-wrap ìƒì„±
 * - ìë™ìœ¼ë¡œ initChipsWrap ì ìš©ë¨
 */
document.getElementById('add-dynamic').addEventListener('click', () => {
    const container = document.getElementById('dynamic-container');
    const wrap = document.createElement('div');
    wrap.className = 'chips-wrap';
    wrap.innerHTML = `
        <div class="chips-container">
            <div class="chip">D1</div><div class="chip">D2</div><div class="chip">D3</div>
            <div class="chip">D4</div><div class="chip">D5</div>
        </div>
        <button class="toggle-btn" type="button" aria-expanded="false">í† ê¸€</button>
    `;
    container.appendChild(wrap);
});
</script>

</body>
</html>