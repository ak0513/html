<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Chips Wrap ìƒ˜í”Œ</title>
<style>
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif; padding: 16px; }
    .chips-wrap { margin: 16px 0; }

    .chips-container {
        display: flex;
        gap: 8px;
        overflow-x: auto;
        padding-bottom: 6px;
        scroll-behavior: smooth;
        -webkit-overflow-scrolling: touch;
    }
    .chip {
        flex: 0 0 auto;
        padding: 8px 12px;
        background: #e9e9ee;
        border-radius: 20px;
        white-space: nowrap;
        font-size: 14px;
    }
    .chips-wrap.vertical .chips-container { flex-wrap: wrap; overflow-x: hidden; scroll-behavior: auto; }
    .chips-wrap.scroll-end { background: #fafafa; }
    .toggle-btn { margin-top: 8px; padding: 6px 10px; border-radius: 10px; border: 1px solid #d7d7df; background: #fff; }
    .toggle-btn.hidden { display: none; }

    /* ìˆ¨ê¹€ ë¶€ëª¨ ì˜ˆì‹œ */
    .hidden-parent { display: none; padding: 10px; border: 1px dashed #ccc; margin: 20px 0; }
</style>
</head>
<body>

<h2>ğŸ“Œ ì¹©ìŠ¤ ìƒ˜í”Œ (ì´ˆê¸° ë Œë”ë§)</h2>
<div class="chips-wrap">
    <div class="chips-container">
        <div class="chip">ì¹©1</div><div class="chip">ì¹©2</div><div class="chip">ì¹©3</div>
        <div class="chip">ì¹©4</div><div class="chip">ì¹©5</div><div class="chip">ì¹©6</div>
        <div class="chip">ì¹©7</div><div class="chip">ì¹©8</div>
    </div>
    <button class="toggle-btn" type="button" aria-expanded="false">í† ê¸€</button>
</div>

<h2>ğŸ“Œ ìˆ¨ê²¨ì¡Œë‹¤ê°€ ë‚˜íƒ€ë‚˜ëŠ” ë¶€ëª¨ ì˜ˆì‹œ</h2>
<button id="show-hidden">ìˆ¨ê²¨ì§„ ë¶€ëª¨ í‘œì‹œ</button>
<div class="hidden-parent" id="hidden-parent">
    <div class="chips-wrap">
        <div class="chips-container">
            <div class="chip">ìˆ¨1</div><div class="chip">ìˆ¨2</div><div class="chip">ìˆ¨3</div>
            <div class="chip">ìˆ¨4</div><div class="chip">ìˆ¨5</div><div class="chip">ìˆ¨6</div>
             <div class="chip">ìˆ¨4</div><div class="chip">ìˆ¨5</div><div class="chip">ìˆ¨6</div>
             <div class="chip">ìˆ¨4</div><div class="chip">ìˆ¨5</div><div class="chip">ìˆ¨6</div>
        </div>
        <button class="toggle-btn" type="button" aria-expanded="false">í† ê¸€</button>
    </div>
</div>

<h2>ğŸ“Œ ë™ì  ìƒì„± ìƒ˜í”Œ</h2>
<button id="add-dynamic">ë™ì  Chips Wrap ì¶”ê°€</button>
<div id="dynamic-container"></div>

<!-- ===================== ê¸°ë³¸ Chips Wrap ìŠ¤í¬ë¦½íŠ¸ ===================== -->
<script>
const WRAP_STATE = new WeakMap();

function setScrollLeftInstant(el, x) {
    const prev = el.style.scrollBehavior;
    el.style.scrollBehavior = 'auto';
    el.scrollLeft = x;
    el.style.scrollBehavior = prev || '';
}

function initChipsWrap(wrap) {
    const container = wrap.querySelector('.chips-container');
    const toggleBtn = wrap.querySelector('.toggle-btn');
    if (!container || !toggleBtn) return;

    WRAP_STATE.set(wrap, { vertical: false });
    const getState = () => WRAP_STATE.get(wrap);

    const checkScrollEnd = () => {
        const { vertical } = getState();
        if (vertical) { wrap.classList.remove('scroll-end'); return; }
        const isEnd = Math.ceil(container.scrollLeft + container.clientWidth) >= container.scrollWidth;
        wrap.classList.toggle('scroll-end', isEnd);
    };

    const checkToggleVisibility = () => {
        const { vertical } = getState();
        const hasScroll = container.scrollWidth > container.clientWidth;
        const hide = !vertical && !hasScroll;
        toggleBtn.classList.toggle('hidden', hide);
    };

    const updateState = () => {
        checkToggleVisibility();
        checkScrollEnd();
    };

    toggleBtn.addEventListener('click', () => {
        const state = getState();
        const nextVertical = !state.vertical;
        state.vertical = nextVertical;
        WRAP_STATE.set(wrap, state);
        wrap.classList.toggle('vertical', nextVertical);
        toggleBtn.setAttribute('aria-expanded', String(nextVertical));
        if (nextVertical) setScrollLeftInstant(container, 0);
        requestAnimationFrame(updateState);
    });

    container.addEventListener('scroll', () => {
        if (getState().vertical) { setScrollLeftInstant(container, 0); return; }
        checkScrollEnd();
    });

    if ('ResizeObserver' in window) { new ResizeObserver(updateState).observe(container); } 
    else { window.addEventListener('resize', updateState); }

    new MutationObserver(updateState).observe(container, { childList: true, subtree: true });

    if ('IntersectionObserver' in window) {
        const io = new IntersectionObserver((entries) => {
            entries.forEach(entry => { if (entry.isIntersecting) updateState(); });
        }, { threshold: 0 });
        io.observe(wrap);
    }

    updateState();
}

document.querySelectorAll('.chips-wrap').forEach(initChipsWrap);

new MutationObserver((mutations) => {
    mutations.forEach((m) => {
        m.addedNodes.forEach((node) => {
            if (!(node instanceof HTMLElement)) return;
            if (node.classList?.contains('chips-wrap')) { initChipsWrap(node); }
            else node.querySelectorAll?.('.chips-wrap').forEach(initChipsWrap);
        });
    });
}).observe(document.body, { childList: true, subtree: true });
</script>

<!-- ===================== ìƒ˜í”Œ ë™ì‘ ìŠ¤í¬ë¦½íŠ¸ ===================== -->
<script>
document.getElementById('show-hidden').addEventListener('click', () => {
    const hidden = document.getElementById('hidden-parent');
    hidden.style.display = 'block';
});

document.getElementById('add-dynamic').addEventListener('click', () => {
    const container = document.getElementById('dynamic-container');
    const wrap = document.createElement('div');
    wrap.className = 'chips-wrap';
    wrap.innerHTML = `
        <div class="chips-container">
            <div class="chip">D1</div><div class="chip">D2</div><div class="chip">D3</div>
            <div class="chip">D4</div><div class="chip">D5</div> <div class="chip">ìˆ¨4</div><div class="chip">ìˆ¨5</div><div class="chip">ìˆ¨6</div>
             <div class="chip">ìˆ¨4</div><div class="chip">ìˆ¨5</div><div class="chip">ìˆ¨6</div>
        </div>
        <button class="toggle-btn" type="button" aria-expanded="false">í† ê¸€</button>
    `;
    container.appendChild(wrap);
});
</script>

</body>
</html>