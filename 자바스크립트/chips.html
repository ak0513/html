<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Chips Wrap â€“ Toggle & Scroll</title>
<style>
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif; padding: 16px; }

    .chips-wrap { margin: 16px 0; }

    /* ê°€ë¡œ ëª¨ë“œ ê¸°ë³¸ */
    .chips-container {
        display: flex;
        gap: 8px;
        overflow-x: auto;
        padding-bottom: 6px;     /* ëª¨ë°”ì¼ì„œ ìŠ¤í¬ë¡¤ ì¡ê¸° ìš©ì´ */
        scroll-behavior: smooth;
        -webkit-overflow-scrolling: touch;
    }
    .chip {
        flex: 0 0 auto;
        padding: 8px 12px;
        background: #e9e9ee;
        border-radius: 20px;
        white-space: nowrap;
        font-size: 14px;
    }

    /* ë²„í‹°ì»¬ ëª¨ë“œ(ì„¸ë¡œ ë‚˜ì—´) */
    .chips-wrap.vertical .chips-container {
        flex-wrap: wrap;
        overflow-x: hidden;   /* ê°€ë¡œ ìŠ¤í¬ë¡¤ ë” */
        scroll-behavior: auto;
    }

    /* ìŠ¤í¬ë¡¤ ë ê°ì§€ ìƒíƒœ (ì˜ˆì‹œ ìŠ¤íƒ€ì¼) */
    .chips-wrap.scroll-end { background: #fafafa; }

    .toggle-btn {
        margin-top: 8px;
        padding: 6px 10px;
        border-radius: 10px;
        border: 1px solid #d7d7df;
        background: #fff;
    }
    .toggle-btn.hidden { display: none; }
</style>
</head>
<body>

<h2>ğŸ“Œ ì¹©ìŠ¤ê°€ ë§ì€ ê²½ìš° (ìŠ¤í¬ë¡¤ O)</h2>
<div class="chips-wrap">
    <div class="chips-container">
        <div class="chip">ì¹©1</div><div class="chip">ì¹©2</div><div class="chip">ì¹©3</div>
        <div class="chip">ì¹©4</div><div class="chip">ì¹©5</div><div class="chip">ì¹©6</div>
        <div class="chip">ì¹©7</div><div class="chip">ì¹©8</div><div class="chip">ì¹©9</div>
        <div class="chip">ì¹©10</div><div class="chip">ì¹©11</div><div class="chip">ì¹©12</div>
    </div>
    <button class="toggle-btn" type="button" aria-expanded="false">í† ê¸€</button>
</div>

<h2>ğŸ“Œ ì¹©ìŠ¤ê°€ ì ì€ ê²½ìš° (ìŠ¤í¬ë¡¤ X)</h2>
<div class="chips-wrap">
    <div class="chips-container">
        <div class="chip">A</div><div class="chip">B</div><div class="chip">C</div>
    </div>
    <button class="toggle-btn" type="button" aria-expanded="false">í† ê¸€</button>
</div>

<script>
/**
 * ë‚´ë¶€ ìƒíƒœ ì €ì¥ (í´ë˜ìŠ¤ë¥¼ ì½ì–´ì„œ ë¡œì§ íŒë‹¨í•˜ì§€ ì•ŠìŒ)
 * vertical: í˜„ì¬ ì„¸ë¡œ ëª¨ë“œ ì—¬ë¶€
 */
const WRAP_STATE = new WeakMap();

/** ìœ í‹¸: ì• ë‹ˆë©”ì´ì…˜ ì—†ì´ ê°€ë¡œ ìŠ¤í¬ë¡¤ ìœ„ì¹˜ ì„¤ì • */
function setScrollLeftInstant(el, x) {
    const prev = el.style.scrollBehavior;
    el.style.scrollBehavior = 'auto';
    el.scrollLeft = x;
    // reflow ìœ ë„ê¹Œì§€ëŠ” í•„ìš”ì—†ìŒ
    el.style.scrollBehavior = prev || '';
}

function initChipsWrap(wrap) {
    if (!wrap) return;
    const container = wrap.querySelector('.chips-container');
    const toggleBtn = wrap.querySelector('.toggle-btn');
    if (!container || !toggleBtn) return;

    // ìƒíƒœ ì´ˆê¸°í™”
    WRAP_STATE.set(wrap, { vertical: false });

    const getState = () => WRAP_STATE.get(wrap);

    // ìŠ¤í¬ë¡¤ ë ê°ì§€ (ê°€ë¡œ ëª¨ë“œì—ì„œë§Œ ì˜ë¯¸)
    const checkScrollEnd = () => {
        const { vertical } = getState();
        if (vertical) {
            wrap.classList.remove('scroll-end');
            return;
        }
        const isEnd = Math.ceil(container.scrollLeft + container.clientWidth) >= container.scrollWidth;
        wrap.classList.toggle('scroll-end', isEnd);
    };

    // í† ê¸€ ë²„íŠ¼ ê°€ì‹œì„±
    // - ê°€ë¡œ ëª¨ë“œ: ìŠ¤í¬ë¡¤ì´ ìˆì„ ë•Œë§Œ ë³´ì„
    // - ì„¸ë¡œ ëª¨ë“œ: í•­ìƒ ë³´ì„ (ë²„ê·¸ ë°©ì§€: í† ê¸€ í›„ ì‚¬ë¼ì§€ì§€ ì•Šê²Œ)
    const checkToggleVisibility = () => {
        const { vertical } = getState();
        const hasScroll = container.scrollWidth > container.clientWidth;
        const hide = !vertical && !hasScroll;
        toggleBtn.classList.toggle('hidden', hide);
    };

    const updateState = () => {
        checkToggleVisibility();
        checkScrollEnd();
    };

    // í† ê¸€ ë™ì‘
    toggleBtn.addEventListener('click', () => {
        const state = getState();
        const nextVertical = !state.vertical;
        state.vertical = nextVertical;
        WRAP_STATE.set(wrap, state);

        // ìŠ¤íƒ€ì¼ í´ë˜ìŠ¤ë¡œëŠ” UIë§Œ ë³€ê²½ (ë¡œì§ì€ ìƒíƒœ ì‚¬ìš©)
        wrap.classList.toggle('vertical', nextVertical);
        toggleBtn.setAttribute('aria-expanded', String(nextVertical));

        // ë²„ê·¸ í”½ìŠ¤ 1: ë²„í‹°ì»¬ ì§„ì… ì‹œ ê°€ë¡œ ìŠ¤í¬ë¡¤ ì”ìƒ ì œê±°
        if (nextVertical) {
            setScrollLeftInstant(container, 0);
        }

        // ë ˆì´ì•„ì›ƒ ì ìš© í›„ ìƒíƒœ ê°±ì‹  (1í”„ë ˆì„ ë’¤)
        requestAnimationFrame(updateState);
    });

    // ì´ë²¤íŠ¸ & ì˜µì €ë²„
    container.addEventListener('scroll', () => {
        // ë²„ê·¸ í”½ìŠ¤ 2: ì„¸ë¡œ ëª¨ë“œì¼ ë• ìŠ¤í¬ë¡¤ ìƒíƒœë¥¼ ê°•ì œë¡œ ì´ˆê¸°í™”
        if (getState().vertical) {
            setScrollLeftInstant(container, 0);
            return;
        }
        checkScrollEnd();
    });

    // ì‚¬ì´ì¦ˆ ë³€ë™ ëŒ€ì‘: ResizeObserverë¥¼ ìš°ì„  ì‚¬ìš©
    if ('ResizeObserver' in window) {
        const ro = new ResizeObserver(updateState);
        ro.observe(container);
    } else {
        window.addEventListener('resize', updateState);
    }

    // ì¹©ìŠ¤ ë™ì  ì¶”ê°€/ì œê±° ëŒ€ì‘
    const childObserver = new MutationObserver(updateState);
    childObserver.observe(container, { childList: true, subtree: true });

    // ì´ˆê¸° ìƒíƒœ ì ìš©
    updateState();
}

// ì´ˆê¸° ë¡œë“œ ì‹œ ëª¨ë“  ë© ì´ˆê¸°í™”
document.querySelectorAll('.chips-wrap').forEach(initChipsWrap);

// chips-wrap ìì²´ê°€ ë™ì ìœ¼ë¡œ ì¶”ê°€ë˜ëŠ” ê²½ìš°ë„ ëŒ€ì‘
const wrapObserver = new MutationObserver((mutations) => {
    mutations.forEach((m) => {
        m.addedNodes.forEach((node) => {
            if (!(node instanceof HTMLElement)) return;
            if (node.classList?.contains('chips-wrap')) {
                initChipsWrap(node);
            } else {
                // ë© ë‚´ë¶€ì— ë™ì  ìƒì„±ëœ ê²½ìš°(í…œí”Œë¦¿ ë“±)
                node.querySelectorAll?.('.chips-wrap').forEach(initChipsWrap);
            }
        });
    });
});
wrapObserver.observe(document.body, { childList: true, subtree: true });
</script>

</body>
</html>