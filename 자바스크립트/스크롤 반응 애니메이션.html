<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>스크롤 애니메이션</title>
    <style>
        body {
            min-height: 500vh;
            margin: 0;
            padding: 0 24px;
            background-color: #111;
            background-image:
                linear-gradient(rgba(255, 255, 255, .07) 2px, transparent 2px),
                linear-gradient(90deg, rgba(255, 255, 255, .07) 2px, transparent 2px),
                linear-gradient(rgba(255, 255, 255, .06) 1px, transparent 1px),
                linear-gradient(90deg, rgba(255, 255, 255, .06) 1px, transparent 1px);
            background-size: 100px 100px, 100px 100px, 20px 20px, 20px 20px;
            background-position: -2px -2px, -2px -2px, -1px -1px, -1px -1px;
            overflow-x: hidden;
        }
        .p {
            position: relative;
        }
        .scrolling-element {
            position: absolute;
            top: 50%;
            left: 0;
            width: 100px;
            height: 100px;
            border: 1px solid #000;
            background-color: #fff;
            transition: transform 0.1s ease; /* 부드러운 이동 */
        }
        .scrolling-element.ele1 {
            background-color: red;
            top: 0;
        }
        .scrolling-element.ele2 {
            top: 60%;
            background-color: blue;
        }
        .scrolling-element.ele3 {
            top: 70%;
            background-color: green;
        }
    </style>
</head>
<body>
    <div style="height:1000px;background-color: bisque;"></div>
    <div class="p">
        <div class="scrolling-element ele1" data-height="1000" data-animation-scale="[2, 1, 100, 1000]" data-animation-translateX="[0, 400, 100, 1000]" data-animation-translateY="[0, 200, 100, 1000]"></div>
    </div>
    <div style="height:1000px;background-color: bisque;"></div>

    <script>
        const scrollingElements = document.querySelectorAll('.scrolling-element');
        
        // 스크롤 위치에 따른 애니메이션 계산
        const calculateAnimation = (element, scrollY, windowHeight) => {
            const rect = element.getBoundingClientRect();
            const parentElement = element.parentElement;
            const elementHeight = element.clientHeight;
            
            const elementOffsetTop = parentElement.offsetTop;
            const scrollLimit = parseFloat(element.dataset.animationScale.split(',')[3]);
            const animationStart = elementOffsetTop;
            const animationEnd = animationStart + scrollLimit;
            
            const threshold = parseInt(element.dataset.animationScale.split(',')[2]) / 100;

            const isVisible = scrollY + windowHeight * (1 - threshold) >= animationStart && scrollY <= animationEnd;

            let transformValue = '';
            const parentElementHeight = parseFloat(element.getAttribute('data-height'));
            if (parentElementHeight) {
                parentElement.style.height = `${parentElementHeight}px`;
            }

            // 함수로 중복 로직 처리
            const getInterpolatedValue = (dataAttr, type) => {
                if (!element.dataset[dataAttr]) return 0;
                const [startValue, endValue] = JSON.parse(element.dataset[dataAttr]);
                const progress = Math.min(
                    Math.max((scrollY + windowHeight * (1 - threshold) - animationStart) / scrollLimit, 0),
                    1
                );
                return isVisible ? startValue + (endValue - startValue) * progress : startValue;
            };

            // Scale, translateX, translateY 처리
            transformValue += `scale(${getInterpolatedValue('animationScale', 'scale')})`;
            transformValue += ` translateX(${getInterpolatedValue('animationTranslatex', 'translateX')}px)`;
            transformValue += ` translateY(${getInterpolatedValue('animationTranslatey', 'translateY')}px)`;

            element.style.transform = transformValue.trim();
        };

        // 스크롤 이벤트가 발생할 때마다 업데이트
        const updateScrollPosition = () => {
            const scrollY = window.scrollY;
            const windowHeight = window.innerHeight;

            scrollingElements.forEach((element) => {
                calculateAnimation(element, scrollY, windowHeight);
            });
        };

        window.addEventListener('scroll', updateScrollPosition);

        // 초기 업데이트
        updateScrollPosition();
    </script>
</body>
</html>
