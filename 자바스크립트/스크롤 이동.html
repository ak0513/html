<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Scroll to Element</title>
	<style>
		body {
			margin: 0;
			padding: 0;
		}

		#section1 {
			text-align: center;
		}

		#section2 {
			height: 300px;
			background-color: lightcoral;
		}

		#section1 {
			position: fixed;
			bottom: 100px;
			left: 0;
			right: 0;
		}
	</style>
</head>

<body>
	<div style="height:2000px"></div>
	<section id="section1">
		<div>
			<button type="button" onclick="smoothScrollTo2('section2')">Scroll to Section 2</button>
			<button type="button" onclick="smoothScrollTo2('section2', 50)">Scroll to Section 2</button>
			<button type="button" onclick="smoothScrollTo2('section2', -50 , 'bottom')">Scroll to Section 2</button>
			<button type="button" onclick="smoothScrollTo2('section2', 100, 'top', 2000, function() {console.log('Scrolled to bottom with offset');})">Scroll to Section 2</button>
		</div>
		<div style="margin-top:8px;">
			<button type="button" data-st-duration="500" onclick="smoothScrollTo('section2')">Scroll to Section 2</button>
			<button type="button" data-st-offset="100" onclick="smoothScrollTo('section2')">Scroll to Section 2</button>
			<button type="button" data-st-position="bottom" onclick="smoothScrollTo('section2')">Scroll to Section 2</button>
			<button type="button" data-st-position="bottom" data-st-duration="2000" onclick="smoothScrollTo('section2', function() {console.log('Scrolled to bottom with offset');})">Scroll to Section 2</button>
		</div>
	</section>
	<section id="section2">
		Welcome to Section 2
	</section>
	<div style="height:2000px"></div>
	<script>

var isScrolling = false; // 재호출 방지 플래그

// 공통 스크롤 함수
function smoothScrollTo(targetId, callback) {
	if (isScrolling) return; // 실행 중일 때는 무시

	// 기본값 설정
	var targetElement = document.getElementById(targetId);
	if (!targetElement) {
		console.error('ID가 ' + targetId + '인 요소를 찾을 수 없습니다.');
		return;
	}
	// data-st- 속성에서 기본값 읽어오기
	var offset = event.target.hasAttribute('data-st-offset') ? parseInt(event.target.dataset.stOffset) : 0;
	var position = event.target.hasAttribute('data-st-position') ? event.target.dataset.stPosition : 'top';
	var duration = event.target.hasAttribute('data-st-duration') ? parseInt(event.target.dataset.stDuration) : 1000;

	// 시작 스크롤 위치
	var start = window.pageYOffset;
	var targetRect = targetElement.getBoundingClientRect();
	var targetOffset = (position === 'top') ? targetRect.top : targetRect.bottom - window.innerHeight;
	targetOffset -= offset;

	var scrollTarget = start + targetOffset;

	// 타겟 위치가 이미 정확히 맞춰져 있으면 함수 종료
	if (Math.abs(scrollTarget - start) < 1) {
		console.log('이미 목표 위치에 있습니다.');
		return;
	}

	isScrolling = true; // 실행 상태로 플래그 설정

	var startTime = performance.now(); // 애니메이션 시작 시간 기록

	function scrollStep(timestamp) {
		var elapsedTime = timestamp - startTime; // 경과 시간
		var progress = Math.min(elapsedTime / duration, 1); // 정속 진행 (Linear)
		var easeInOutQuad = (progress < 0.5) ? 2 * progress * progress : 1 - Math.pow(-2 * progress + 2, 2) / 2; // 변속 진행

		window.scrollTo(0, start + targetOffset * easeInOutQuad);
		// window.scrollTo(0, start + targetOffset * progress); // 정속 진행으로 하는 경우

		if (elapsedTime < duration) {
			requestAnimationFrame(scrollStep);
		} else {
			isScrolling = false; // 애니메이션 완료 후 플래그 초기화
			
			// 콜백 함수가 정의되어 있으면 호출
			if (typeof callback === 'function') {
				callback();
			}
		}
	}

	requestAnimationFrame(scrollStep);
}
	
// 공통 스크롤 함수2
function smoothScrollTo2(targetId, offset, position, duration, callback) {
	if (isScrolling) return; // 실행 중일 때는 무시
	// 기본값 설정 (IE 호환)
	if (typeof duration === 'undefined') { duration = 1000; }
	if (typeof offset === 'undefined') { offset = 0; }
	if (typeof position === 'undefined') { position = 'top'; }

	var targetElement = document.getElementById(targetId);
	if (!targetElement) {
		console.error('ID가 ' + targetId + '인 요소를 찾을 수 없습니다.');
		return;
	}

	var start = window.pageYOffset;
	var targetRect = targetElement.getBoundingClientRect();

	// 타겟 위치 계산
	var targetOffset = (position === 'top') ? targetRect.top : targetRect.bottom - window.innerHeight;

	// 추가 오프셋 적용
	targetOffset -= offset;

	var scrollTarget = start + targetOffset;

	// 타겟 위치가 이미 정확히 맞춰져 있으면 함수 종료
	if (Math.abs(scrollTarget - start) < 1) {
		console.log('이미 목표 위치에 있습니다.');
		return;
	}

	isScrolling = true; // 실행 상태로 플래그 설정

	var startTime = performance.now();

	function scrollStep(timestamp) {
		var elapsedTime = timestamp - startTime;
		var progress = Math.min(elapsedTime / duration, 1);
		var easeInOutQuad = (progress < 0.5) ? 2 * progress * progress : 1 - Math.pow(-2 * progress + 2, 2) / 2;
		window.scrollTo(0, start + targetOffset * easeInOutQuad);
		if (elapsedTime < duration) {
			requestAnimationFrame(scrollStep);
		} else {
			isScrolling = false; // 애니메이션 완료 후 플래그 초기화

			// 콜백 함수가 정의되어 있으면 호출
			if (typeof callback === 'function') {
				callback();
			}
		}
	}
	requestAnimationFrame(scrollStep);
}

	</script>
</body>

</html>