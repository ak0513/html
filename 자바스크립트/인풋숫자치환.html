<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>14자리 숫자 입력 마스킹</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 50px;
        }
        input {
            font-size: 18px;
            padding: 10px;
            width: 300px;
        }
    </style>
</head>
<body>

<h2>14자리 숫자 1입력</h2>
<input type="text" id="secureInput" placeholder="숫자 14자리 입력" />

<script>
    const inputEl = document.getElementById('secureInput');
    let rawValue = '';

    inputEl.addEventListener('beforeinput', (e) => {
        // 모바일에서 입력 전 이벤트로 처리해야 커서 깨짐 방지 가능
        const selectionStart = inputEl.selectionStart;
        const selectionEnd = inputEl.selectionEnd;

        const isDelete = e.inputType === 'deleteContentBackward';
        let inputChar = e.data || '';

        // 기존 숫자만 남긴 원본
        rawValue = rawValue.replace(/\D/g, '');

        if (isDelete) {
            // 삭제 처리
            let rawIndex = getRawIndexFromMasked(selectionStart - 1);
            if (rawIndex >= 0) {
                rawValue = rawValue.slice(0, rawIndex) + rawValue.slice(rawIndex + 1);
            }
        } else if (/\d/.test(inputChar) && rawValue.length < 14) {
            // 숫자 입력 처리
            let rawIndex = getRawIndexFromMasked(selectionStart);
            rawValue = rawValue.slice(0, rawIndex) + inputChar + rawValue.slice(rawIndex);
        }

        e.preventDefault(); // 기본 동작 방지
        renderMaskedValue();
    });

    function getRawIndexFromMasked(maskedIndex) {
        // maskedIndex 기준으로 raw index 계산
        let rawIndex = 0;
        for (let i = 0; i < maskedIndex; i++) {
            if (rawIndex >= rawValue.length) break;
            const masked = getMaskedCharAt(rawIndex);
            if (masked.length === 2) i++; // 하이픈 포함 길이
            rawIndex++;
        }
        return rawIndex;
    }

    function getMaskedCharAt(i) {
        let ch = rawValue[i] || '';
        if (i >= 6 && i <= 10) ch = '*';
        let result = ch;
        if (i === 2 || i === 6 || i === 7 || i === 9) result += '-';
        return result;
    }

    function renderMaskedValue() {
        let masked = '';
        for (let i = 0; i < rawValue.length; i++) {
            masked += getMaskedCharAt(i);
        }

        const cursorPos = getCursorFromRaw(rawValue.length);
        inputEl.value = masked;
        inputEl.setSelectionRange(cursorPos, cursorPos);
    }

    function getCursorFromRaw(rawLen) {
        let pos = 0;
        for (let i = 0; i < rawLen; i++) {
            pos++;
            if (i === 2 || i === 6 || i === 7 || i === 9) pos++;
        }
        return pos;
    }
</script>

</body>
</html>