<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>부모-자식 세트 동적 추가</title>
</head>
<body>

    <!-- 기존 체크박스 그룹 -->
    <div id="checkbox-container">
        <div data-group-container="group1">
            <label>
                <input type="checkbox" data-checkbox="parent" data-group="group1"> 전체 선택 (그룹 1)
            </label>
            <br>
            <label>
                <input type="checkbox" data-checkbox="child" data-group="group1"> 항목 1-1
            </label>
            <br>
            <label>
                <input type="checkbox" data-checkbox="child" data-group="group1"> 항목 1-2
            </label>
        </div>
    </div>

    <button onclick="addCheckboxSet()">부모-자식 세트 추가</button>

    <script>
        document.addEventListener("change", function (event) {
            const target = event.target;

            // 부모 체크박스가 변경된 경우 → 해당 그룹의 자식 체크박스 전체 선택/해제
            if (target.matches("[data-checkbox='parent']")) {
                const group = target.dataset.group;
                const childCheckboxes = document.querySelectorAll(`[data-checkbox='child'][data-group='${group}']`);

                childCheckboxes.forEach(child => {
                    child.checked = target.checked;
                });
            }

            // 자식 체크박스가 변경된 경우 → 해당 그룹의 부모 체크박스 상태 업데이트
            if (target.matches("[data-checkbox='child']")) {
                const group = target.dataset.group;
                const parentCheckbox = document.querySelector(`[data-checkbox='parent'][data-group='${group}']`);
                const childCheckboxes = document.querySelectorAll(`[data-checkbox='child'][data-group='${group}']`);

                const allChecked = Array.from(childCheckboxes).every(child => child.checked);
                parentCheckbox.checked = allChecked;
            }
        });

        // 부모-자식 세트를 동적으로 추가하는 함수
        function addCheckboxSet() {
            const container = document.getElementById("checkbox-container");
            const groupId = `group${document.querySelectorAll("[data-group-container]").length + 1}`;

            const newGroup = document.createElement("div");
            newGroup.setAttribute("data-group-container", groupId);
            newGroup.innerHTML = `
                <label>
                    <input type="checkbox" data-checkbox="parent" data-group="${groupId}"> 전체 선택 (${groupId})
                </label>
                <br>
                <label>
                    <input type="checkbox" data-checkbox="child" data-group="${groupId}"> 항목 1
                </label>
                <br>
                <label>
                    <input type="checkbox" data-checkbox="child" data-group="${groupId}"> 항목 2
                </label>
            `;
            container.appendChild(newGroup);
        }
    </script>

</body>
</html>