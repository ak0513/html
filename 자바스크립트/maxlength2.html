<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>iOS maxlength 우회</title>
  <style>
    input {
      width: 300px;
      padding: 8px;
      font-size: 16px;
      margin-bottom: 10px;
    }
    input.maxed {
      background-color: #ffe6e6;
      border: 2px solid red;
    }
  </style>
</head>
<body>
  <h3>정적 input</h3>
  <input type="text" class="watch-length" data-maxlength="6" placeholder="최대 6자 입력" />

  <h3>동적으로 추가된 input</h3>
  <button id="addInput">인풋 추가</button>
  <div id="dynamic-container"></div>

  <script>
    function enforceMaxLength(input, maxLength) {
      let isComposing = false;

      input.addEventListener('compositionstart', () => {
        isComposing = true;
      });

      input.addEventListener('compositionend', () => {
        isComposing = false;
        trimValue();
      });

      input.addEventListener('input', () => {
        if (!isComposing) trimValue();
      });

      function trimValue() {
        if (input.value.length > maxLength) {
          input.value = input.value.slice(0, maxLength);
        }

        if (input.value.length >= maxLength) {
          input.classList.add('maxed');
          input.setAttribute('aria-invalid', 'true');
        } else {
          input.classList.remove('maxed');
          input.removeAttribute('aria-invalid');
        }
      }
    }

    // 초기 인풋 적용
    document.querySelectorAll('.watch-length').forEach(input => {
      const max = parseInt(input.dataset.maxlength, 10);
      enforceMaxLength(input, max);
    });

    // 동적 input 생성
    document.getElementById('addInput').addEventListener('click', () => {
      const newInput = document.createElement('input');
      newInput.type = 'text';
      newInput.placeholder = '동적 input (최대 8자)';
      newInput.classList.add('watch-length');
      newInput.setAttribute('data-maxlength', '8');
      document.getElementById('dynamic-container').appendChild(newInput);

      enforceMaxLength(newInput, 8);
    });
  </script>
</body>
</html>