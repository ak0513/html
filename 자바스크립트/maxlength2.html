<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>iOS 한글 maxlength 대응</title>
  <style>
    .input-limit {
      border: 2px solid red;
    }
  </style>
</head>
<body>
  <h3>✅ 적용된 인풋</h3>
  <input type="text" class="limit-input" maxlength="5" placeholder="최대 5자" />

  <h3>❌ 일반 인풋 (비교용)</h3>
  <input type="text" maxlength="5" placeholder="최대 5자" />

  <br /><br />
  <button id="addInput">➕ 인풋 동적 추가</button>
  <div id="inputContainer"></div>

  <script>
    function enforceMaxLength(input) {
      const max = parseInt(input.getAttribute('maxlength'), 10);
      let previousValue = "";

      input.addEventListener('beforeinput', (e) => {
        if (input.value.length >= max && e.inputType !== 'deleteContentBackward') {
          e.preventDefault(); // 입력 자체 차단
          input.classList.add('input-limit');
        }
      });

      input.addEventListener('compositionstart', () => {
        previousValue = input.value;
      });

      input.addEventListener('compositionend', () => {
        const maxLength = parseInt(input.getAttribute('maxlength'), 10);
        if (input.value.length > maxLength) {
          input.value = input.value.slice(0, maxLength); // 잘라냄
        }
      });

      input.addEventListener('input', () => {
        if (input.value.length > max) {
          input.value = input.value.slice(0, max);
        }

        // 스타일 초기화
        if (input.value.length < max) {
          input.classList.remove('input-limit');
        }
      });
    }

    // 초기 인풋 적용
    document.querySelectorAll('input.limit-input').forEach(enforceMaxLength);

    // 동적 인풋 생성
    document.getElementById('addInput').addEventListener('click', () => {
      const input = document.createElement('input');
      input.type = 'text';
      input.setAttribute('maxlength', '5');
      input.classList.add('limit-input');
      input.placeholder = '동적 인풋 (최대 5자)';
      document.getElementById('inputContainer').appendChild(input);
      enforceMaxLength(input);
    });
  </script>
</body>
</html>