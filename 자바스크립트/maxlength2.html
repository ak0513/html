<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>iOS Maxlength Fix</title>
  <style>
    body { padding: 2em; font-family: sans-serif; }
    input {
      padding: 0.5em;
      font-size: 18px;
      width: 100%;
      box-sizing: border-box;
      margin-bottom: 1em;
    }
  </style>
</head>
<body>
  <h2>iOS 대응 강제 maxlength 입력</h2>

  <input type="text" class="fixed-maxlength" data-maxlength="5" placeholder="최대 5자" />

  <button onclick="addInput()">+ 동적 인풋 추가</button>
  <div id="dynamic"></div>

  <script>
    function enforceMaxLength(input, max) {
      const trimToMax = () => {
        if (input.value.length > max) {
          input.value = input.value.slice(0, max);
        }
      };

      let isComposing = false;

      input.addEventListener('compositionstart', () => {
        isComposing = true;
      });

      input.addEventListener('compositionend', () => {
        isComposing = false;
        trimToMax();
      });

      input.addEventListener('input', () => {
        if (!isComposing) {
          trimToMax();
        }
      });
    }

    function applyToAll() {
      const inputs = document.querySelectorAll('.fixed-maxlength');
      inputs.forEach(input => {
        const max = parseInt(input.dataset.maxlength, 10);
        enforceMaxLength(input, max);
      });
    }

    function addInput() {
      const wrapper = document.getElementById('dynamic');
      const input = document.createElement('input');
      input.type = 'text';
      input.className = 'fixed-maxlength';
      input.placeholder = '동적 인풋 (5자)';
      input.setAttribute('data-maxlength', '5');
      wrapper.appendChild(input);
      enforceMaxLength(input, 5);
    }

    // 초기 적용
    applyToAll();
  </script>
</body>
</html>