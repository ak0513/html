<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>탭 & 3뎁스 버튼 드래그</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            height: 100vh;
            margin: 0;
        }
        .container {
            display: flex;
            width: 100%;
        }
        .left-panel {
            width: 200px;
            background: #f4f4f4;
            padding: 10px;
            display: flex;
            flex-direction: column;
        }
        .left-panel .group {
            margin-bottom: 10px;
        }
        .left-panel .group-title {
            font-weight: bold;
            padding: 5px;
            background: #ddd;
        }
        .left-panel .button-list {
            padding-left: 10px;
        }
        .left-panel li {
            list-style-type: none;
        }
        .left-panel button {
            margin: 5px 0;
            padding: 10px;
            width: 100%;
            cursor: pointer;
            user-select: none;
            touch-action: none;
        }
        .left-panel button.is_active {
            background-color: #ddd;
            font-weight: bold;
        }
        .right-panel {
            flex-grow: 1;
            padding: 10px;
        }
        .tabs {
            display: flex;
            border-bottom: 2px solid #ddd;
            min-height: 40px;
            flex-wrap: nowrap;
        }
        .tab {
            padding: 10px 15px;
            cursor: grab;
            border: 1px solid #ddd;
            border-bottom: none;
            background: #f9f9f9;
            margin-right: 5px;
            display: flex;
            align-items: center;
            user-select: none;
        }
        .tab.is_active {
            background: white;
            font-weight: bold;
        }
        .tab .close {
            margin-left: 10px;
            cursor: pointer;
            font-weight: bold;
        }
        .tab-content {
            padding: 10px;
            border: 1px solid #ddd;
            height: 300px;
            display: none;
        }
        .tab-content.is_active {
            display: block;
        }
        .dragging {
            opacity: 0.5;
            color: red;
        }
        .three-level {
            margin-left: 20px;
            margin-top: 10px;
        }
        .right-panel .three-level-button {
            margin: 10px;
            padding: 10px;
            background: #ddd;
            cursor: grab;
            user-select: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="left-panel">
            <div class="group">
                <div class="group-title">Group 1</div>
                <ul class="button-list">
                    <li><button type="button" data-name="Tab 1-1">Tab 1-1</button></li>
                    <li><button type="button" data-name="Tab 1-2">Tab 1-2</button></li>
                </ul>
            </div>
            <div class="group">
                <div class="group-title">Group 2</div>
                <ul class="button-list">
                    <li><button type="button" data-name="Tab 2-1">Tab 2-1</button></li>
                    <li><button type="button" data-name="Tab 2-2">Tab 2-2</button></li>
                </ul>
            </div>
            <div class="group">
                <div class="group-title">Group 3 (3뎁스)</div>
                <ul class="button-list">
                    <li><button type="button" data-name="Tab 3-1">Tab 3-1</button></li>
                    <li><button type="button" data-name="Tab 3-2">Tab 3-2</button></li>
                    <li><button type="button" data-name="Tab 3-3">Tab 3-3</button></li>
                </ul>
            </div>
        </div>
        <div class="right-panel">
            <div class="tabs"></div>
            <div class="content-container"></div>
            <div class="three-level-buttons">
                <!-- 3뎁스 버튼들 추가 -->
                <div class="three-level-button" data-name="3-Button 1">3-Button 1</div>
                <div class="three-level-button" data-name="3-Button 2">3-Button 2</div>
                <div class="three-level-button" data-name="3-Button 3">3-Button 3</div>
            </div>
        </div>
    </div>

    <script>
        const tabsContainer = document.querySelector('.tabs');
        const contentContainer = document.querySelector('.content-container');
        const leftPanelButtons = document.querySelectorAll('.left-panel button');
        const rightPanelButtons = document.querySelectorAll('.right-panel .three-level-button');
        let draggedTab = null;

        function addTab(tabName) {
            let existingTab = document.querySelector(`.tab[data-name="${tabName}"]`);
            if (existingTab) {
                setActiveTab(existingTab);
                return;
            }

            const tab = document.createElement('div');
            tab.classList.add('tab');
            tab.setAttribute('data-name', tabName);
            tab.setAttribute('draggable', true);
            tab.innerHTML = `${tabName} <span class="close">×</span>`;
            tab.onclick = () => setActiveTab(tab);

            tab.querySelector('.close').onclick = (e) => {
                e.stopPropagation();
                removeTab(tabName);
            };

            // 드래그 시작
            tab.addEventListener('dragstart', (e) => {
                draggedTab = tab;
                setTimeout(() => tab.style.opacity = '0.5', 0); // 드래그 시작 시 탭이 반투명해짐
            });

            // 드래그 종료
            tab.addEventListener('dragend', () => {
                setTimeout(() => {
                    draggedTab.style.opacity = '1';
                    draggedTab = null;
                }, 0);
            });

            // 드래그한 탭이 드롭될 위치 계산
            tab.addEventListener('dragover', (e) => {
                e.preventDefault();
                const currentTab = e.target;
                if (currentTab !== draggedTab) {
                    const bounding = currentTab.getBoundingClientRect();
                    const offset = bounding.y + bounding.height / 2;
                    if (e.clientY - offset > 0) {
                        tabsContainer.insertBefore(draggedTab, currentTab.nextSibling);
                    } else {
                        tabsContainer.insertBefore(draggedTab, currentTab);
                    }
                }
            });

            tabsContainer.appendChild(tab);
            
            const tabContent = document.createElement('div');
            tabContent.classList.add('tab-content');
            tabContent.setAttribute('data-name', tabName);
            contentContainer.appendChild(tabContent);

            setActiveTab(tab);
        }

        function setActiveTab(tab) {
            document.querySelectorAll('.tab, .tab-content').forEach(el => el.classList.remove('is_active'));
            tab.classList.add('is_active');
            document.querySelector(`.tab-content[data-name="${tab.getAttribute('data-name')}"]`).classList.add('is_active');

            document.querySelectorAll('.left-panel button').forEach(button => button.classList.remove('is_active'));
            const leftButton = document.querySelector(`.left-panel button[data-name="${tab.getAttribute('data-name')}"]`);
            if (leftButton) leftButton.classList.add('is_active');
        }

        function removeTab(tabName) {
            document.querySelector(`.tab[data-name="${tabName}"]`)?.remove();
            document.querySelector(`.tab-content[data-name="${tabName}"]`)?.remove();
        }

        function addRightPanelButton(buttonName) {
            const button = document.createElement('div');
            button.classList.add('three-level-button');
            button.setAttribute('data-name', buttonName);
            button.textContent = buttonName;
            button.setAttribute('draggable', true);

            // 드래그 시작
            button.addEventListener('dragstart', (e) => {
                draggedTab = button;
                setTimeout(() => button.style.opacity = '0.5', 0); // 드래그 시작 시 버튼이 반투명해짐
            });

            // 드래그 종료
            button.addEventListener('dragend', () => {
                setTimeout(() => {
                    button.style.opacity = '1';
                    draggedTab = null;
                }, 0);
            });

            // 드래그한 버튼이 드롭될 위치 계산
            button.addEventListener('dragover', (e) => {
                e.preventDefault();
                const currentButton = e.target;
                if (currentButton !== draggedTab) {
                    const bounding = currentButton.getBoundingClientRect();
                    const offset = bounding.y + bounding.height / 2;
                    if (e.clientY - offset > 0) {
                        currentButton.parentElement.insertBefore(draggedTab, currentButton.nextSibling);
                    } else {
                        currentButton.parentElement.insertBefore(draggedTab, currentButton);
                    }
                }
            });

            document.querySelector('.three-level-buttons').appendChild(button);
        }

        // 왼쪽 패널 버튼 클릭 시 탭 추가
        leftPanelButtons.forEach(button => {
            button.onclick = () => addTab(button.textContent.trim());
        });

        // 오른쪽 패널에 3뎁스 버튼들을 동적으로 추가
        rightPanelButtons.forEach(button => {
            addRightPanelButton(button.textContent.trim());
        });
    </script>
</body>
</html>
