<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Array Parsing with Date-wise List and Currency-wise Totals Example</title>
</head>

<body>
    <style>
        /* reset */
        body,div,dl,dt,dd,ul,ol,li,h1,h2,h3,h4,h5,h6,pre,code,form,fieldset,legend,textarea,p,blockquote,th,td,input,select,textarea,button{margin:0;padding:0}
        fieldset,img{border:0 none}
        dl,ul,ol,menu,li {list-style:none}
        blockquote, q {quotes: none}
        blockquote:before, blockquote:after,q:before, q:after {content:'';content:none}
        input,select,textarea,button {vertical-align:middle;outline:none}
        input::-ms-clear {display:none}
        button {border:0 none;background-color:transparent;cursor:pointer}
        body,th,td,input,select,textarea,button {font-size:14px;line-height:1.5;font-family:-apple-system, BlinkMacSystemFont, Pretendard, "Segoe UI", Roboto, Oxygen-Sans, Ubuntu, Cantarell,'Noto Sans KR', 'Spoqa Han Sans', "Helvetica Neue", sans-serif;}
        a {color:#333;text-decoration:none} 
        a:active, a:hover {text-decoration:underline}
        a:active {background-color:transparent}
        address,caption,cite,code,dfn,em,var {font-style:normal;font-weight:normal}
        
        body {background:#fefefe;-webkit-text-size-adjust:none;color:#111}
        #header{position:relative;padding:20px 24px;background-color:#10B886;}
        .page-title {color:#fff;}
        .sort {display:flex;}
        .sort-btn {color:#fff;text-decoration:underline;}
        .sort-btn.active {color:#fff000;}
        .sort-btn + .sort-btn {margin-left:8px;}
        .map-link {position:absolute;top:50%;right:24px;transform:translateY(-50%);background-color:#0a926a;padding:4px 8px;border-radius:4px;color:#fff;}

        #main {padding-bottom:40px;}
        .list-wrap {display:none;margin-top:20px;}
        .list-wrap.active {display:block;}

        .list {position:relative;padding:0 16px;}
        .list + .list {margin-top:24px;padding-top:12px;}
        .list +  .list::before {content:'';display:block;position:absolute;top:0;left:0;right:0;height:12px;background-color:#ddd;}
        .list-item  {display:flex;align-items:center;padding:12px 0;}
        .list-title {position:sticky;top:0;display:flex;align-items:center;padding:12px 0;color:#464646;background-color: #fff;}
        .list-icon {height:24px;margin-right:12px;}
        .list-city {color:#999;font-size:12px;}
        .list-name {font-size:16px;font-weight:600;}
        .list-desc {margin-top:4px; color:#999;}
        .list-info-group {flex-grow:1;}

        .amount-group {display:flex;justify-content:flex-end;padding-top:16px;border-top:2px dashed #ddd;text-align:right;}
        .amount-item + .amount-item {margin-left:8px;}
        .amount-currency {color:#999;font-size:12px;}

        .amount-total-group {margin-top:24px;padding:24px 16px 0;border-top:12px solid #ddd;text-align:right;}
        .amount-total-krw {margin-top:12px;padding:0 16px;text-align:right;font-size:16px;}
        .amount-total-krw b {font-size:32px;font-weight:600;}
    </style>
    <div id="wrap">
        <header id="header">
            <h1 class="page-title">페이지 타이틀</h1>
            <div class="sort">
                <button type="button" class="sort-btn active" data-id="listDate">날짜</button>
                <button type="button" class="sort-btn" data-id="listCategory">카테고리</button>
            </div>
            <a href="https://www.google.com/maps/d/viewer?hl=ko&mid=1IngMMEnBJtcJt977z5tkUmn9SSmSF5M&ll=16.056310439202626%2C108.24648315275527&z=14" target="_blank" class="map-link">구글맵 보기</a>
        </header>
        <main id="main">
            <div id="listDate" class="list-wrap active"></div>
            <div id="listCategory" class="list-wrap"></div>
            <div id="total"></div>
        </main>
    </div>
    <script>
        var listDate = document.getElementById('listDate');
        var listCategory = document.getElementById('listCategory');
        var totalAmountEle = document.getElementById('total');
        var exchange = {
            "KRW": [1, '원'], // 환율, 단위
            "VND": [0.05, '동'],
        };
        var myArray = [
            {
                category: ['리조트','home'],
                date: "2023.12.02",
                name: "실크 센스 호이안 리버 리조트",
                url: 'https://www.google.com/maps?cid=3536651011900568809',
                desc: '',
                city: "호이안",
                currency: "KRW",
                amount: 200735,
            },
            {
                category: ['리조트','home'],
                date: "2023.12.02",
                name: "실크 센스 호이안 리버 리조트",
                url: 'https://www.google.com/maps?cid=3536651011900568809',
                desc: '체크인 시 팁(2명)',
                city: "호이안",
                currency: "VND",
                amount: 40000,
            },
            {
                category: ['교통','taxi'],
                date: "2023.12.02",
                name: "택시",
                url: '',
                desc: '리조트에서 올드타운',
                city: "호이안",
                currency: "VND",
                amount: 127000,
            },
            {
                category: ['식당','restaurant'],
                date: "2023.12.02",
                name: "Hi restaurant",
                url: 'https://www.google.com/maps?cid=16051465188882781673',
                desc: '현지식당',
                city: "호이안",
                currency: "VND",
                amount: 210000,
            },
            {
                category: ['마사지','spa'],
                date: "2023.12.02",
                name: "The Angel Spa",
                url: 'https://www.google.com/maps?cid=10296173432950896393',
                desc: '발마사지 완전 비추',
                city: "호이안",
                currency: "VND",
                amount: 300000,
            },
            {
                category: ['펍','bar'],
                date: "2023.12.02",
                name: "Cỏ Smoothies",
                url: 'https://www.google.com/maps?cid=13222426912866144198',
                desc: '',
                city: "호이안",
                currency: "VND",
                amount: 100000,
            },
            {
                category: ['마트','mart'],
                date: "2023.12.02",
                name: "KT 과일",
                url: 'https://www.google.com/maps?cid=2791247604064331689',
                desc: '망고스틴 1kg',
                city: "호이안",
                currency: "VND",
                amount: 190000,
            },
            {
                category: ['교통','taxi'],
                date: "2023.12.02",
                name: "그랩",
                url: '',
                desc: '올드타운에서 리조트',
                city: "호이안",
                currency: "VND",
                amount: 124000,
            },
            {
                category: ['마트','mart'],
                date: "2023.12.02",
                name: "리조트 앞 슈퍼",
                url: '',
                desc: '맥주 5캔 구매',
                city: "호이안",
                currency: "VND",
                amount: 104000,
            },
            {
                category: ['리조트','home'],
                date: "2023.12.03",
                name: "실크 센스 호이안 리버 리조트",
                url: 'https://www.google.com/maps?cid=3536651011900568809',
                desc: '',
                city: "호이안",
                currency: "KRW",
                amount: 0,
            },
        ];

        // 날짜별 정렬
        var groupedByDate = {};
        myArray.forEach(function (item) {
            var key = item.date;
            if (!groupedByDate[key]) {
                groupedByDate[key] = [];
            }
            groupedByDate[key].push(item);
        });

        function sortDate() {
            // HTML parsing and display for Date-wise List
            var output = ``;
            for (var date in groupedByDate) {
                if (groupedByDate.hasOwnProperty(date)) {
                    output += `<div class="list">`;
                    output += `<h3 class="list-title date">${date}</h3>`;
                    output += `<ul class="list-group">`;

                    var currencyTotals = {};

                    groupedByDate[date].forEach(function (item, index) {
                        output += 
                            `<li class="list-item">
                                <div class="list-icon"><img src="./img/${item.category[1]}.svg" alt=""></div>
                                <div class="list-info-group">
                                    <div class="list-city">${item.category[0]} · ${item.city}</div>
                                    <div class="list-name"><a href="${item.url}" target="_blank" title="새창으로 열림">${item.name}</a></div>`
                        if(item.desc !== undefined) {
                            output += `<div class="list-desc">${item.desc}</div>`
                        }
                        output += 
                            `</div>
                                <div class="list-amount-group">
                                    <div class="list-amount"><b>${item.amount.toLocaleString('ko-KR')}</b>${exchange[item.currency][1]}</div>
                                </div>
                            </li>`;

                        // Calculate currency-wise totals for each date
                        if (!currencyTotals[item.currency]) {
                            currencyTotals[item.currency] = 0;
                        }
                        currencyTotals[item.currency] += item.amount;
                    });
                    output += `</ul>`;
                    // Display currency-wise totals for each date
                    // output += `<h3 class="list-title amount">합계</h3>`;
                    output += `<ul class="amount-group">`;
                    for (var currency in currencyTotals) {
                        if (currencyTotals.hasOwnProperty(currency)) {
                            output += `<li class="amount-item"><b>${currencyTotals[currency].toLocaleString('ko-KR')}</b>${exchange[currency][1]}<span class="amount-currency">(${currency})</span></li>`;
                        }
                    }
                    output += `</ul>`;
                    output += `</div>`;
                }
            }
            listDate.innerHTML = output;
        }
        sortDate();

        // 카테고리별 정렬
        var groupedByCategory = {};
        myArray.forEach(function (item) {
            var key = item.category;
            if (!groupedByCategory[key]) {
                groupedByCategory[key] = [];
            }
            groupedByCategory[key].push(item); 
        });

        function sortCategory() {
            var output = ``;
            for (var category in groupedByCategory) {
                if (groupedByCategory.hasOwnProperty(category)) {
                output += `<div class="list">`;
                output += `<h3 class="list-title date"><div class="list-icon"><img src="./img/${category.split(',')[1]}.svg" alt=""></div><div>${category.split(',')[0]}</div></h3>`;
                output += `<ul class="list-group">`;

                var currencyTotals = {};

                groupedByCategory[category].forEach(function (item) {
                    output += 
                        `<li class="list-item">
                            <div class="list-info-group">
                                <div class="list-city">${item.category[0]} · ${item.city}</div>
                                <div class="list-name"><a href="${item.url}" target="_blank" title="새창으로 열림">${item.name}</a></div>`
                                if(item.desc !== undefined) {
                            output += `<div class="list-desc">${item.desc}</div>`
                        }
                        output += 
                            `</div>
                            <div class="list-amount-group">
                                <div class="list-amount"><b>${item.amount.toLocaleString('ko-KR')}</b>${exchange[item.currency][1]}</div>
                            </div>
                        </li>`;
                        // output += `City: " + item.city + ", Amount: " + item.amount + ", Currency: " + item.currency + "</li>`

                    // Calculate currency-wise totals for each category
                    if (!currencyTotals[item.currency]) {
                    currencyTotals[item.currency] = 0;
                    }
                    currencyTotals[item.currency] += item.amount;
                });
                output += `</ul>`;

                // Display currency-wise totals for each category
                output += `<ul class="amount-group">`;
                // output += `<h3>Currency-wise Totals<h3>`;
                for (var currency in currencyTotals) {
                    if (currencyTotals.hasOwnProperty(currency)) {
                    output += `<li class="amount-item"><b>${currencyTotals[currency].toLocaleString('ko-KR')}</b>${exchange[currency][1]}<span class="amount-currency">(${currency})</span></li>`;
                    }
                }
                output += `</ul>`;

                output += `</div>`;
                }
            }
            listCategory.innerHTML = output;
        }
        sortCategory();



        // 전체 합계
        function totalAmount() {
            var currencyTotals = {};
            var totalAmountKRW = 0;

            myArray.forEach(function (item) {
                if (!currencyTotals[item.currency]) {
                currencyTotals[item.currency] = 0;
                }
                currencyTotals[item.currency] += item.amount;
                totalAmountKRW += item.amount * exchange[item.currency][0];
            });

            var output = `<ul class="amount-total-group">`;
            for (var currency in currencyTotals) {
                if (currencyTotals.hasOwnProperty(currency)) {
                    output += `<li class="amount-total-item">${currency} : <b>${currencyTotals[currency].toLocaleString('ko-KR')}</b>${exchange[currency][1]}</li>`;
                }
            }
            output += `</ul>`;
            output += `<div class="amount-total-krw">합계 <b>${totalAmountKRW.toLocaleString('ko-KR')}</b>원</div>`;


            totalAmountEle.innerHTML = output;
        }
        totalAmount();
        

        // 노출
        function siblings(ele) {
            if(typeof(ele) === 'string') {
                ele = document.querySelector(ele)
            }
            var siblings = [...ele.parentNode.children].filter((child) =>
                child !== ele
            )
            return siblings
        }
        var sort = document.querySelectorAll('.sort-btn');
        var listWrap = document.querySelectorAll('.list-wrap');

        sort.forEach(function(item) {
            item.addEventListener('click', function() {
                var si = siblings(item)
                si.forEach(function(item) {
                    item.classList.remove('active');
                });
                item.classList.add('active');

                listWrap.forEach(function(item) {
                    item.classList.remove('active')
                });
                var tarId = document.getElementById(item.dataset.id);
                tarId.classList.add('active')
            })
        })
    </script>
</body>

</html>