<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sorting and Filtering Objects in DOM</title>
</head>
<body>

<div id="wrap">
    <header id="header">
        <h1 class="page-title">제목</h1>
        <input type="text" id="search" placeholder="Search by number">
        <div class="sort">
            <button type="button" class="sort-btn active" data-id="data-container">날짜</button>
            <button type="button" class="sort-btn" data-id="data-container2">넘버</button>
        </div>
    </header>
    <main id="main">
        <div id="data-container" class="list-wrap active"></div>
        <div id="data-container2" class="list-wrap"></div>
    </main>
</div>



<style>
    /* reset */
    body,div,dl,dt,dd,ul,ol,li,h1,h2,h3,h4,h5,h6,pre,code,form,fieldset,legend,textarea,p,blockquote,th,td,input,select,textarea,button{margin:0;padding:0}
    fieldset,img{border:0 none}
    dl,ul,ol,menu,li {list-style:none}
    blockquote, q {quotes: none}
    blockquote:before, blockquote:after,q:before, q:after {content:'';content:none}
    input,select,textarea,button {vertical-align:middle;outline:none}
    input::-ms-clear {display:none}
    button {border:0 none;background-color:transparent;cursor:pointer}
    body,th,td,input,select,textarea,button {font-size:14px;line-height:1.5;font-family:-apple-system, BlinkMacSystemFont, Pretendard, "Segoe UI", Roboto, Oxygen-Sans, Ubuntu, Cantarell,'Noto Sans KR', 'Spoqa Han Sans', "Helvetica Neue", sans-serif;}
    a {color:#333;text-decoration:none} 
    a:active, a:hover {text-decoration:underline}
    a:active {background-color:transparent}
    address,caption,cite,code,dfn,em,var {font-style:normal;font-weight:normal}
    
    body {background:#fefefe;-webkit-text-size-adjust:none;color:#111}
    #header{position:relative;padding:20px 24px;background-color:#e31838;background-color:#fff;}
    .page-title {color:#fff;}
    .sort {display:flex;}
    .sort-btn {color:#fff;text-decoration:underline;}
    .sort-btn.active {color:#fff000;}
    .sort-btn + .sort-btn {margin-left:8px;}

    .h-tit2 {position:relative; font-weight:700;font-size:16px;margin-bottom:12px;}
    .list + .h-tit2 {margin-top:24px;padding-top:36px;}
    .list + .h-tit2::before {content:'';display:block;position:absolute;top:0;left:-24px;right:-24px;height:12px;background-color:#ddd;}

    #main {padding:0 24px 40px;}
    .list-wrap {display:none;margin-top:20px;}
    .list-wrap.active {display:block;}

    .list {display:flex;justify-content:space-between;align-items:center;padding:12px 0;}
    .list + .list {margin-top:20px;}
    .list-right {flex-shrink:0;text-align:right;}
    .list-date,
    .list-number {font-size:12px;color:#999;}
    .list-name {font-size:16px;font-weight:600;}
    .list-weight {font-size:14px;color:#999;font-weight:400;}
    .list-by-unit {font-size:12px;color:#999;}
    .list-amount-group {font-size:12px;}
    .list-amount {color:#999;text-decoration:line-through;font-size:12px;}
    .list-price {font-weight:600;}

    .no-discount .list-amount,
    .no-discount .list-discount {display:none;}


    #data-container .list-date {display:none;}
    #data-container2 .list-number {display:none;}


</style>

<script>
// 객체 배열 생성
var data = [
    // ℓ ㎖ g kg 병 
    { date: "2024.02.18", number: 623559, name: "진로소주360", amount: 24190, discount: 0, weight:20, unit:'병'},
    { date: "2024.02.18", number: 643733, name: "카스473MLX24 캔", amount: 37990, discount: 0, weight:11352, unit:'㎖'},
    { date: "2024.02.19", number: 639952, name: "백진주쌀 10KG", amount: 36990, discount: 3000, weight:10, unit:'kg'},
    { date: "2024.02.19", number: 647983, name: "체리토마토 2KG", amount: 16990, discount: 0, weight:2, unit:'kg'},
    { date: "2024.02.19", number: 647019, name: "친환경양피망", amount: 14990, discount: 0, weight:4, unit:'kg'},
    { date: "2024.02.19", number: 659969, name: "청경채 7C0G", amount: 7290, discount: 0, weight:0, unit:'kg'},
    { date: "2024.02.19", number: 507154, name: "햄스빌베이컨", amount: 16890, discount: 0, weight:0, unit:'kg'},
    { date: "2024.02.19", number: 612635, name: "찌개부침두부", amount: 5690, discount: 0, weight:0, unit:'kg'},
    { date: "2024.02.19", number: 530318, name: "친환경양배추", amount: 5990, discount: 0, weight:0, unit:'kg'},
];

// 날짜와 넘버로 그룹화하고 소팅하는 함수
function groupAndSortByDateAndNumber(data, sort) {
    var groupedData = {};
    data.forEach(function(item) {
        var key = null;
        if(sort === 'date') {
            key = item.date;
        } else if(sort === 'number') {
            key = item.number;
        }
        if (!groupedData[key]) {
            groupedData[key] = [];
        }
        groupedData[key].push(item);
    });

    // 날짜별로 객체 배열 소팅
   /*  for (var key in groupedData) {
        if (groupedData.hasOwnProperty(key)) {
            groupedData[key].sort(function(a, b) {
                return a.number - b.number;
            });
        }
    } */

    return groupedData;
}

// amount에 쉼표 추가하는 함수
/* function addCommasToAmount(amount) {
    return amount.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
} */

// amount에 쉼표 추가하는 함수
function addCommasToAmount(amount) {
    // 입력된 값이 문자열인지 확인합니다.
    if (typeof amount !== 'string') {
        amount = amount.toString();
    }
    
    // 소수점을 찾습니다.
    const decimalIndex = amount.indexOf(".");
    if (decimalIndex !== -1) {
        // 소수점 이하 3자리까지만 유지합니다.
        amount = parseFloat(amount).toFixed(3);
        // 소수점 이하의 0을 모두 제거합니다.
        amount = amount.replace(/\.?0*$/, "");
    }
    // 쉼표 추가
    return amount.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
}


// 데이터를 DOM에 표시하는 함수
function renderData(data, container, sort) {
    // 기존 내용 비우기
    container.innerHTML = "";

    // 날짜별로 그룹화하고 넘버별로 소팅
    var groupedData = groupAndSortByDateAndNumber(data, sort);

    // 날짜순으로 소팅
    var dates = Object.keys(groupedData).sort();

    // 날짜별로 데이터 표시
    dates.forEach(function(date) {
        var dateDiv = document.createElement("div");
        dateDiv.classList.add('h-tit2')
        dateDiv.textContent = `${date}`;
        container.appendChild(dateDiv);

        groupedData[date].forEach(function(item) {
            var div = document.createElement("div");
            div.classList.add('list');
            var price = item.amount - item.discount;
            var formattedPrice = addCommasToAmount(price);
            var formattedAmount = addCommasToAmount(item.amount);
            var formattedDiscount = addCommasToAmount(item.discount);
            // 할인이 없는 경우 금액만 노출
            if(item.discount === 0) {
                div.classList.add('no-discount')
            }
            // 단위 당 금액
            var listByUnit = null;
            switch(item.unit) {
                case 'g' :
                    listByUnit = '(100g 당 ' + addCommasToAmount(price / item.weight * 100) + '원)';
                    break;
                case 'kg' :
                    listByUnit = '(100g 당 ' + addCommasToAmount(price / item.weight / 10) + '원)';
                    break;
                case 'ℓ' :
                    listByUnit = '(100㎖ 당 ' + addCommasToAmount(price / item.weight * 100) + '원)';
                    break;
                case '㎖' :
                    listByUnit = '(100㎖ 당 ' + addCommasToAmount(price / item.weight / 10) + '원)';
                    break;
                case '병' :
                    listByUnit = '(1병 당 ' + addCommasToAmount(price / item.weight) + '원)';
                    break;
            }
            div.innerHTML = `
                <div class="list-left">
                    <div class="list-date">${item.date}</div>
                    <div class="list-number">${item.number}</div>
                    <div class="list-name">
                        ${item.name}
                        <span class="list-weight">(${addCommasToAmount(item.weight)}${item.unit})</span>
                    </div>
                </div>
                <div class="list-right">
                    <div class="list-amount-group">
                        <span class="list-amount">${formattedAmount}</span>
                        <span class="list-discount">(${formattedDiscount})</span>
                    </div>
                    <div class="list-price">${formattedPrice}원</div>
                    <div class="list-by-unit">${listByUnit}</div>
                </div>
            `;
            container.appendChild(div);
        });
    });
}

// 검색 기능 구현
document.getElementById("search").addEventListener("input", function() {
    var searchTerm = this.value.trim().toLowerCase();
    var filteredData = data.filter(function(item) {
        return item.name.toString().includes(searchTerm);
    });
    renderData(filteredData, document.getElementById('data-container'), 'date');
    renderData(filteredData, document.getElementById('data-container2'), 'number');
});

function siblings(ele) {
    if(typeof(ele) === 'string') {
        ele = document.querySelector(ele)
    }
    var siblings = [...ele.parentNode.children].filter((child) =>
        child !== ele
    )
    return siblings
}


// 탭
var sort = document.querySelectorAll('.sort-btn');
var listWrap = document.querySelectorAll('.list-wrap');

sort.forEach(function(item) {
    item.addEventListener('click', function() {
        var si = siblings(item)
        si.forEach(function(item) {
            item.classList.remove('active');
        });
        item.classList.add('active');

        listWrap.forEach(function(item) {
            item.classList.remove('active')
        });
        var tarId = document.getElementById(item.dataset.id);
        tarId.classList.add('active')
    })
})

// 초기 데이터를 DOM에 렌더링
renderData(data, document.getElementById('data-container'), 'date');
renderData(data, document.getElementById('data-container2'), 'number');
</script>

</body>
</html>
